<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>A plan for Parrot</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">A plan for Parrot</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../html/index.html">Contents</a> | <a href="../../html/info.html">Project Information</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>ROADMAP &#45; A plan for Parrot</p>

<h1><a name="PURPOSE"
>PURPOSE <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>As of this writing,
there is no one place in which all remaining parrot work is documented.
There are various TODO files,
the RT queue,
comments in the source code and the documentation.
This document is a first pass at unifying this information and providing a single point of reference for anyone interested in the current state of the parrot,
whether they are developers looking for items to work on,
or external users looking for an idea of when they can expect a release.</p>

<p>This document is not meant to contain all the metadata regarding particular tasks,
but merely provide a summary of the tasks.</p>

<p>This document is now becoming a roadmap,
because the Architect is deep in a weeklong mindmeld with the Pumpking and the results are being encoded in this document,
among others.</p>

<h1><a name="CURRENT_RELEASE_(0.2.3)"
>CURRENT RELEASE (0.2.3) <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>Parrot 0.2.3 has been released on Aug 5th 2005.
For a list of new and fixed feature see <a href='TODO'>NEWS</a>.</p>

<h1><a name="OVERVIEW"
>OVERVIEW <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>The remaining tasks are broken down into the following categories,
roughly listed in the order through which a task might progress.</p>

<h2><a name="METADATA"
>METADATA <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Each task has certain metadata associated with it which must be tracked.
Eventually all metadata should be stored in RT at <a href='https://rt.perl.org/rt3/'>https://rt.perl.org/rt3/</a></p>

<h2><a name="DESIGN"
>DESIGN <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>These are pending design decisions which must be made before any code can be written to implement them.
Note &#45; DESIGN <i>is</i> a special kind of documentation task,
but due to the nature of this kind of documentation,
it deserves to be broken out into its own category.</p>

<h2><a name="TODO"
>TODO <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Any item,
whether visible to parrot users or hidden behind an API,
that has already been designed (but not implemented) belongs here.</p>

<h2><a name="BUGFIX"
>BUGFIX <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Any items which have been implemented but don&#39;t work as expected.</p>

<h2><a name="PORTABILITY"
>PORTABILITY <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Any items which are specific to a particular platform or require special attention for cross&#45;platform compatibility.</p>

<h2><a name="DOCUMENTATION"
>DOCUMENTATION <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Any items pertaining to source,
API,
or user level documentation.</p>

<h2><a name="HIGH_LEVEL_LANGUAGES"
>HIGH LEVEL LANGUAGES <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Parrot currently ships with several partial language implementations.
Any tasks which are specific to those languages,
or affect cross&#45;language compatibility will be listed here.</p>

<h1><a name="ISSUES"
>ISSUES <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<h2><a name="METADATA"
>METADATA <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>To be included: docs/pmc,
docs/resources,
docs/*.pod,
anything in SVN not in docs,
RT.
(That is,
quite a bit.)</li><p class="pad"></p>

<p>[[What does this item mean,
exactly?
&#45;&#45;Chip]]</p>
</ul>

<h2><a name="DOCUMENTATION"
>DOCUMENTATION <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>Eliminate dead documentation.
Let historians dig through our subversion history.
We look forward toward successful deployment.</li><p class="pad"></p>

<li>When docs and code disagree,
they must be brought into agreement immediately.
At the <i>very</i> least,
appropriately mark docs that are apparently wrong but may eventually become right,
e.g.: &#34;<code lang='und' xml:lang='und'>[NOTE: this does not currently work. Why? &#45;&#45;committer]</code>&#34;.</li><p class="pad"></p>

<p>PDDs are not exceptions to this rule!
Fix them when they&#39;re wrong.
Delete them when they&#39;re obsolete.
(Never delete docs lightly,
though.
Check first with someone who should know.)</p>

<li>Document project goals and priorities,
based on Chip&#39;s talk to APW as found at <a href='http://feather.perl6.nl/~chip/Chip_APW.sxi'><a href="http://feather.perl6.nl/~chip/Chip_APW.sxi">http://feather.perl6.nl/~chip/Chip_APW.sxi</a></a> or <a href='http://feather.perl6.nl/~chip/Chip_APW.pdf'><a href="http://feather.perl6.nl/~chip/Chip_APW.pdf">http://feather.perl6.nl/~chip/Chip_APW.pdf</a></a>.</li><p class="pad"></p>

<li><a href='TODO'>memory_internals.pod</a> has a question about whether or not string reuse is limited to a single user or multiple users.</li><p class="pad"></p>
</ul>

<h2><a name="DESIGN"
>DESIGN <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>MMD Roundup 2,
from the mailing list:</li><p class="pad"></p>

<p><a href="http://xrl.us/gvfw">http://xrl.us/gvfw</a> (Link to groups&#45;beta.google.com)</p>

<p>Section 1 of that email needs a decision from the Architect.</p>

<li>Variable&#45;length register frames are an approved feature,
but the design still needs fleshing out.
Then there are the minor details of documentation and implementation.
:&#45;,</li><p class="pad"></p>

<li>Calling conventions are definitely changing for the better,
but not in a way that need change much of substance for language implementors.
Chip/Leo mind meld is in progress; stay tuned.</li><p class="pad"></p>

<p>BTW: Don&#39;t panic!
Life is getting better for you,
the Parrot user.
It had already become obvious recently to us that Parrot needed a nice opcode&#45;based interface for automated collection and extraction of call parameters and return values.
That&#39;s what you were going to write to anyway.
How it works,
precisely,
shouldn&#39;t matter much.
(You <i>were</i> writing to PIR instead of PASM,
right?)</p>

<li>Design the standard library to replace all those opcodes that should never have been opcodes in the first place,
e.g.
the IO and transcendental math features.</li><p class="pad"></p>

<p>(Note: Whatever tech we use to implement transcendental math should at *worst* compile to function calls under JIT.
And I&#39;ll consider making exceptions for the transcendantal math if someone can show me why.)</p>

<p>I expect PIR will still let you pretend they&#39;re opcodes,
though,
to avoid immediate howls of outrage.
(But only silicon&#45;based life forms write PASM,
so we&#39;re not worried about that.)</p>

<li>Do detailed design on new Chip/Leo&#45;agreed&#45;in&#45;principle lexical system.</li><p class="pad"></p>

<p>The key change learns a lesson that Perl 5 only half learned: Lexical values may be dynamic,
but their names and scopes are known at compile time.
It&#39;s just silly to add &#39;$x&#39; to a newly created pad at runtime,
over and over and over,
every time the same scope is entered.
Silly.</p>

<p>So the names and scopes will be static data attached to the subroutine,
while the data will be in dynamically created pad entries.</p>

<p>Think of a pseudohash: the static data are like the index hash,
which can be shared and immutable; the storage slots are like the rest of the array,
which can be mutable even when the index hash isn&#39;t.</p>

<li>Finish event and IO specification</li><p class="pad"></p>

<li>Finish specification of return continuation and sub being called slots in interpreter,
with introspection</li><p class="pad"></p>

<li>Spec out bytecode metadata system and introspection/modification system</li><p class="pad"></p>

<li>Specify what we need to serialize continuations</li><p class="pad"></p>

<li>Final namespace spec</li><p class="pad"></p>

<li>Solidify design for Truly Evil speed hack for fast regex/string matching</li><p class="pad"></p>

<li>Describe the behavior of init_pmc_props.
<a href='TODO'>PDD02</a></li><p class="pad"></p>

<li>Describe the behavior of the serialization functions.
(freeze,
thaw,
thawfinish,
visit).
<a href='TODO'>PDD02</a></li><p class="pad"></p>

<li>Describe the behavior of <code lang='und' xml:lang='und'>share</code>.
<a href='TODO'>PDD02</a></li><p class="pad"></p>

<li>Describe the components of a <code lang='und' xml:lang='und'>struct PMC_EXT</code>.
<a href='TODO'>PDD04</a></li><p class="pad"></p>

<li>Define what bits of the Parrot internals should be exposed as part of the Parrot API for extension writers.</li><p class="pad"></p>
</ul>

<h2><a name="TODO"
>TODO <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li></li><p class="pad"></p>

<pre lang='und' xml:lang='und'> requester: leo</pre>

<p>Ok. In the long run I expect a multi&#45;stage config system. First is to get miniparrot built and running, then Parrot core. Extensions like gdbm could be configured at that point or even in a third step.</p>

<li>IO: Add IO tables, right now IO&#39;s just float around.</li><p class="pad"></p>

<li>Finish PMC for IO object</li><p class="pad"></p>

<li>IO&#39;s &#34;stdio&#34; layer: buffering, seek/random access, shared streams, thread safe</li><p class="pad"></p>

<li>Copy&#45;on&#45;write IO stacks</li><p class="pad"></p>

<li>Make IO layer cache the vtable calls to the next layer.</li><p class="pad"></p>

<li>IO Filters</li><p class="pad"></p>

<li>IO mmap support</li><p class="pad"></p>

<li>Bottom level socket/pipe/process support in API</li><p class="pad"></p>

<li>UTF layers (or should we not bother and do as a filter?)</li><p class="pad"></p>

<li>Sample programs and test suite</li><p class="pad"></p>

<li>AIO &#45; On many platforms we must fake async IO, are we doing a background thread/interp or an inline event queue function that is called every N ops?</li><p class="pad"></p>

<li>Get digest (probably SHA1) added to bytecode segments</li><p class="pad"></p>

<li>Speed up the OrderedHash implementation</li><p class="pad"></p>

<li>Rearchitect internals for the string specifications.</li><p class="pad"></p>

<li>To PerlClass or not to PerlClass, that is the question. The class hierarchy should be reworked (e.g. Boolean&#45;&#62;PerlInt&#45;&#62;Scalar).</li><p class="pad"></p>

<li>Configuration &#45; missing tests for processor features</li><p class="pad"></p>

<li>Configuration &#45; duplication, e.g. nvsize/numvalsize</li><p class="pad"></p>

<li>Tests &#45; ~1/3 of opcodes are uncovered by tests</li><p class="pad"></p>

<li>IO &#45; Async core isn&#39;t there yet, even though it is rumoured to be.</li><p class="pad"></p>

<li>Overflow detection/promotion to bigint/float types.</li><p class="pad"></p>

<li>Create <code lang='und' xml:lang='und'>opcode_process.pl</code>. <a href='TODO'>PDD05</a></li><p class="pad"></p>

<li>Fill in the remaining functions from the EDA, verify that the test suite still passes, integrate the library into the rest of Parrot, provide PMC types and suitable opcodes. Conversion to and from Parrot strings, conversion to and from floating point types, sprintf output of bignumbers. <a href='TODO'>PDD14</a></li><p class="pad"></p>

<p>[[What&#39;s an EDA? &#45;&#45;Coke]]</p>

<li>Implement the parrot equivalent of perl5&#39;s <code lang='und' xml:lang='und'>$0</code>, based on recent (January 2005) mailing list activity.</li><p class="pad"></p>

<li><code lang='und' xml:lang='und'>load_bytecode</code> does not search the library path to load the file. <a href='TODO#core.ops'>&#34;core.ops&#34; in ops</a></li><p class="pad"></p>

<li>The debugger needs to clone the interpreter to &#34;allow people to play into the debugger and then continue the normal execution of the program.&#34; <a href='TODO#debug.ops'>&#34;debug.ops&#34; in ops</a></li><p class="pad"></p>

<li>parrot doesn&#39;t catch the exception thrown by the op <code lang='und' xml:lang='und'>cmod</code>. <a href='TODO#math.ops'>&#34;math.ops&#34; in ops</a></li><p class="pad"></p>

<li><code lang='und' xml:lang='und'>rx_compile</code> op is documented but unimplemented. <a href='TODO#rx.ops'>&#34;rx.ops&#34; in ops</a></li><p class="pad"></p>

<li>There is no way to do a case&#45;insensitive match. <a href='TODO#rx.ops'>&#34;rx.ops&#34; in ops</a></li><p class="pad"></p>
</ul>

<h2><a name="BUGFIX"
>BUGFIX <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>You can add parents to a class with children and objects, and attributes to a class with children or objects. This is silently allowed and quietly corrupts the child classes and instantiated objects.</li><p class="pad"></p>

<li>building miniparrot is broken</li><p class="pad"></p>

<li>GC issue (copying collector) &#45; immobile strings/buffers get freed during GC.</li><p class="pad"></p>

<li>Memory leak &#45; PIO subsystem leaks file handles (ParrotIO structures)</li><p class="pad"></p>

<li>Memory leak &#45; regexen leak bitmaps</li><p class="pad"></p>

<li>Memory leak &#45; string_to_cstring returns a malloced string, which isn&#39;t freed everywhere</li><p class="pad"></p>

<li>Memory Leaks &#45; imcc is currently leaking Unit structures and possibly more</li><p class="pad"></p>

<li>Regular Expressions &#45; are non reentrant due to interpreter global intstack</li><p class="pad"></p>

<li>JIT &#45; 64 bit integers on 32 bit machines don&#39;t work</li><p class="pad"></p>

<li>JIT &#45; parrot register inspection is incomplete (P&#45;regs)</li><p class="pad"></p>

<li>This sequence:</li><p class="pad"></p>

<pre lang='und' xml:lang='und'>   loop: dec I0
         inc I1       # or add, sub, ...
         if I0, loop</pre>

<p>isn&#39;t handled correctly on JIT/i386.</p>

<li><code lang='und' xml:lang='und'>Parrot_destroy</code> currently leaks most of the memory that it is supposed to free. <a href='TODO'>embed.pod</a></li><p class="pad"></p>
</ul>

<h2><a name="PORTABILITY"
>PORTABILITY <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>Portable fcntl() replacement for platforms without it</li><p class="pad"></p>

<li>See <a href='TODO'>PORTABILITY</a>. Test suite should have no failure on supported platforms.</li><p class="pad"></p>

<li>Tests &#45; src/tests are not supported on all platforms</li><p class="pad"></p>

<li>ParrotIO uses integral file descriptors, which may not be portable. <a href='TODO#io.ops'>&#34;io.ops&#34; in ops</a></li><p class="pad"></p>

<li>conversion ops for machines without 1/2/4 byte integer data types</li><p class="pad"></p>

<li>32 bit pointer/64 bit integer and vv.</li><p class="pad"></p>

<li>dynamic library loading</li><p class="pad"></p>
</ul>

<h2><a name="HIGH_LEVEL_LANGUAGES"
>HIGH LEVEL LANGUAGES <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<ul>
<li>Items in languages/tcl/TODO must be completed.</li><p class="pad"></p>

<li>Get python bytecode translator done</li><p class="pad"></p>

<li>Pass the pie&#45;thon test suite.</li><p class="pad"></p>
</ul>

<h1><a name="FUTURE"
>FUTURE <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>This document should eventually be obsoleted by use of the RT ticketing system, except to the extent that it documents things that show promise but have not yet been committed to. Every task that is actually ready to be done should be documented in RT, and reports generated based on that information.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
