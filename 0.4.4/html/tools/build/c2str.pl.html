<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>constant string support</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">constant string support</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../html/index.html">Contents</a> | <a href="../../../html/tools.html">Tools</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>tools/build/c2str.pl &#45; constant string support</p>

<p>print &#60;&#60;&#34;HEADER&#34;; /* * !!!!!!!
DO NOT EDIT THIS FILE !!!!!!!
* * This file is generated automatically from &#39;$infile&#39; * by $0.
* * Any changes made here will be lost!
* */</p>

<p>#define CONCAT(a,b) a##b #define _S(name) (__PARROT_STATIC_STR(__LINE__)) #define __PARROT_STATIC_STR(line) CONCAT(&#38;static_string_,
line)</p>

<p>#if !
DISABLE_GC_DEBUG # define GC_DEBUG_VERSION ,0 #else # define GC_DEBUG_VERSION #endif</p>

<p>HEADER</p>

<p># currently unused true const strings sub output_string { my ($text,
$line) = @_;</p>

<pre lang='und' xml:lang='und'>  if (exists $known_strings{$text}) {
    &#60;&#60;&#34;DATA&#34;;
#define static_string_${line} static_string_$known_strings{$text}</pre>

<p>DATA } else { $known_strings{$text} = $line; my $h = hash_val($text); &#60;&#60;&#34;DATA&#34;; static /*const*/ char static_string_${line}_data\[\] = $text; static /*const*/ struct parrot_string_t static_string_${line} = { { /* pobj_t */ {{ static_string_${line}_data, sizeof(static_string_${line}_data) }}, (PObj_constant_FLAG|PObj_external_FLAG) GC_DEBUG_VERSION }, sizeof(static_string_${line}_data), static_string_${line}_data, sizeof(static_string_${line}_data) &#45; 1, 1, $h };</p>

<p>DATA } }</p>

<p>open IN, $infile;</p>

<p>my $line = 0; while (&#60;IN&#62;) { $line++; next if m/^\s*#/; # ignore preprocessor next unless s/.*\b_S\b//;</p>

<pre lang='und' xml:lang='und'>  my $str = extract_bracketed $_, &#39;(&#34;)&#39;;

  print output_string (substr($str,1,&#45;1), $line);
}</pre>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
