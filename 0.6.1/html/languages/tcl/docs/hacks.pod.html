<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>Untitled</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Untitled</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../html/index.html">Contents</a> | <a href="../../../../html/languages.html">Language Implementations</a> | <a href="../../../../html/tcl.html">TCL</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="hacks.pod"
>hacks.pod <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Prodding by Matt Diephouse to generate documentation for two things:</p>

<ol>
<li>Things that partcl has done that might be considered hacks &#45; things that will likely impair our ability in the distant future to cleanly do language interoperability.</li><p class="pad"></p>

<li>Things that partcl hasn&#39;t done yet at all because parrot makes them hard.</li><p class="pad"></p>
</ol>

<p>It is,
of course,
quite likely that said feature already exists with a nice interface,
and was just not found by the partcl developers &#45; If you find something along these lines,
let them know on the internals list.</p>

<h1><a name="WORKAROUNDS"
>WORKAROUNDS <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<dl>
<dt><a name="PDD20_&#45;_lexical_vars"
>PDD20 &#45; lexical vars</a></dt><p class="pad"></p>

<dd>The new scheme (PDD20) for lexical vars means that to use the &#39;store_lex&#39;,
and &#39;find_lex&#39; opcodes,
you have to be inside a sub that&#39;s marked :lex: That is,
inside a sub that corresponds to a HLL block that introduces a new lexical scope.
Tcl uses helper functions to figure out whether a particular &#39;$a&#39; is referring to a global or a lexical var.
To keep our current flexibility,
we keep track of the lexpads in the &#39;call_chain&#39; variable and manually look up lexicals in the lexpads.</dd><p class="pad"></p>

<dd>This is in contrast to the previous way lexicals were implemented,
which let you call the _lex opcodes anywhere,
as long as at some point in the past of the program,
you had a created a lex_pad and put it on the stack.</dd><p class="pad"></p>

<dt><a name="subroutine_meta_information."
>subroutine meta information.</a></dt><p class="pad"></p>

<dd>Tcl provides the ability to query subroutines about their arguments and their code.
For example:</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'> % proc sum {{a 2} {b 3}} {
 return [expr $a + $b]
 }
 % sum
 5
 % info args sum
 a b
 % info body sum

  return [expr $a + $b]

 % info default sum a the_argument
 1
 % puts $the_argument
 2
 %</pre>

<dd>Right now, partcl is using globals to store the argument list and the body information. It would seem that we&#39;d want to have a builtin mechanism for querying the subs directly rather than storing this information separately.</dd><p class="pad"></p>

<dt><a name="user_defined_subs;_parameter_handling."
>user defined subs; parameter handling.</a></dt><p class="pad"></p>

<dd>Tcl provides nice exceptions for dealing with argument handling &#45; to continue our example:</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'> % sum a b c
 wrong # args: should be &#34;sum ?a? ?b?&#34;</pre>

<dd>Right now, this is handled <i>inside</i> the function definition &#45; it is defined to take an arbitary number of args, and then is checked for correctness internally. It would be nice to have invoke() automatically figure this out and generate an exception that Tcl can use. (This also starts to drag in &#34;how to do Tcl exceptions cleanly from parrot&#34;)</dd><p class="pad"></p>

<dt><a name="stack_depth"
>stack depth</a></dt><p class="pad"></p>

<dd>Cheating and keeping a global around right now, so we can figure out if we should be using a global or a lexical (and if so, how far down or up).</dd><p class="pad"></p>

<dt><a name="[trace]&#39;ing"
>[trace]&#39;ing</a></dt><p class="pad"></p>

<dd>There are two ways we can go about the tracing &#45; either we can keep the information about the traces in a global, and check that global every time the appropriate action is taken; or, we can tie that information into the actual commands and variables. I think the latter would be somewhat cleaner, and, if any other languages support this feature, this would give us a chance to interoperate.</dd><p class="pad"></p>

<dt><a name="list_splicing"
>list splicing</a></dt><p class="pad"></p>

<dd>There are several cases where we convert TclLists or ResizablePMCArrays to Arrays so that we can use the splice opcode. Need to have better splice support in parrot array classes, as well as our own. See <code lang='und' xml:lang='und'>lib/commands/linsert.pir</code>.</dd><p class="pad"></p>

<dt><a name="flush_diagnostics"
>flush diagnostics</a></dt><p class="pad"></p>

<dd>At the moment, there doesn&#39;t seem to be a parrot method for determining if a filehandled was opened for reading/writing. We can work around this by tracking it in a hash in the _Tcl namespace.</dd><p class="pad"></p>

<dt><a name="[after],_[vwait]"
>[after], [vwait]</a></dt><p class="pad"></p>

<dd>This is waiting, pending the event system re&#45;thunk.</dd><p class="pad"></p>
</dl>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
