<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>Ops To C Code Generation</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Ops To C Code Generation</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../html/index.html">Contents</a> | <a href="../../../html/perl.html">Perl Modules</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>Parrot::OpsFile &#45; Ops To C Code Generation</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<pre lang='und' xml:lang='und'>  use Parrot::OpsFile;</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p><code lang='und' xml:lang='und'>Parrot::OpsFile</code> takes one or more files of op functions and creates real C code for them.</p>

<p>This class is used by <em lang='und' xml:lang='und'><a href="../../tools/build/ops2c.pl.html">tools/build/ops2c.pl</a></em>, <em lang='und' xml:lang='und'><a href="../../tools/build/ops2pm.pl.html">tools/build/ops2pm.pl</a></em> and <em lang='und' xml:lang='und'>tools/build/pbc2c.pl</em>.</p>

<h2><a name="Op_Functions"
>Op Functions <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>For ops that have trivial bodies (such as just a call to some other function and a <code lang='und' xml:lang='und'>return</code> statement), opcode functions are in the format:</p>

<pre lang='und' xml:lang='und'>    inline op opname (args) :flags {
        ... body of function ...
    }</pre>

<p>Note that currently the <code lang='und' xml:lang='und'>inline</code> op type is ignored.</p>

<p>Alternately, for opcode functions that have more internal complexity the format is:</p>

<pre lang='und' xml:lang='und'>    op opname (args) :flags {
        ... body of function ...
    }</pre>

<p>There may be more than one <code lang='und' xml:lang='und'>return</code>.</p>

<p>In both cases the closing brace <b>must</b> be on its own line.</p>

<p>When specifying multiple flags, each flag gets its own prefixing colon.</p>

<h2><a name="Op_Arguments"
>Op Arguments <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>Op arguments are a comma&#45;separated list of direction and type pairs.</p>

<p>Argument direction is one of:</p>

<pre lang='und' xml:lang='und'>    in            the argument passes a value into the op
    out           the argument passes a value out of the op
    inout         the argument passes a value into and out of the op
    inconst       the argument passes a constant value into the op
    invar         the argument passes a variable value into the op</pre>

<p>Argument direction is used to determine the life times of symbols and their related register allocations. When an argument is passed into an op a register is read from, when it&#39;s passed out of an op a register is written to.</p>

<p>Argument type is one of:</p>

<pre lang='und' xml:lang='und'>    INT       the argument is an integer
    NUM       the argument is an numeric
    STR       the argument is an string
    PMC       the argument is an PMC
    KEY       the argument is an aggregate PMC key
    INTKEY    the argument is an aggregate PMC integer key
    LABEL     the argument is an integer branch offset or address</pre>

<p>The size of the return offset is determined from the op function&#39;s signature.</p>

<h2><a name="Op_Flags"
>Op Flags <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>The flags are of two types:</p>

<dl>
<dt><a name="1_class"
>1 class</a></dt><p class="pad"></p>

<dd>The classification of ops is intended to facilitate the selection of suitable ops for a Parrot safe mode.</dd><p class="pad"></p>

<dt><a name="2_behavior"
>2 behavior</a></dt><p class="pad"></p>

<dd>The presence (or absence) of certain flags will change how the op behaviors. For example, the lack of the <code lang='und' xml:lang='und'>flow</code> flag will cause the op to be implicitly terminated with <code lang='und' xml:lang='und'>goto NEXT()</code>. (See next section).</dd><p class="pad"></p>

<dd>The :deprecated flag will generate a diagnostic to standard error at runtime when a deprecated opcode is invoked and <code lang='und' xml:lang='und'>PARROT_WARNINGS_DEPRECATED_FLAG</code> has been set.</dd><p class="pad"></p>
</dl>

<h2><a name="Op_Body_(Macro_Substitutions)"
>Op Body (Macro Substitutions) <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>In the following macro descriptions, <code lang='und' xml:lang='und'>PC</code> and <code lang='und' xml:lang='und'>PC&#39;</code> are the current and next position within the Parrot code.</p>

<dl>
<dt><a name="goto_OFFSET(X)"
><b><code lang='und' xml:lang='und'>goto OFFSET(X)</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = PC + X</code>. This is used for branches.</dd><p class="pad"></p>

<dt><a name="goto_NEXT()"
><b><code lang='und' xml:lang='und'>goto NEXT()</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = PC + S</code>, where <code lang='und' xml:lang='und'>S</code> is the size of an op.</dd><p class="pad"></p>

<dt><a name="goto_ADDRESS(X)"
><b><code lang='und' xml:lang='und'>goto ADDRESS(X)</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = X</code>. This is used for absolute jumps.</dd><p class="pad"></p>

<dt><a name="goto_POP()"
><b><code lang='und' xml:lang='und'>goto POP()</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = &#60;pop&#62;</code>. Pops the address off control stack.</dd><p class="pad"></p>

<dt><a name="expr_OFFSET(X)"
><b><code lang='und' xml:lang='und'>expr OFFSET(X)</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC + X</code>. This is used to give a relative address.</dd><p class="pad"></p>

<dt><a name="expr_NEXT()"
><b><code lang='und' xml:lang='und'>expr NEXT()</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC + S</code>, the position of the next op.</dd><p class="pad"></p>

<dt><a name="expr_ADDRESS(X)"
><b><code lang='und' xml:lang='und'>expr ADDRESS(X)</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>X</code>, an absolute address.</dd><p class="pad"></p>

<dt><a name="OP_SIZE"
><b><code lang='und' xml:lang='und'>OP_SIZE</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>S</code>, the size of an op.</dd><p class="pad"></p>

<dt><a name="HALT()"
><b><code lang='und' xml:lang='und'>HALT()</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = 0</code>. Halts run loop, and resets the current position to the start of the Parrot code, without resuming.</dd><p class="pad"></p>

<dt><a name="restart_OFFSET(X)"
><b><code lang='und' xml:lang='und'>restart OFFSET(X)</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = 0</code> and restarts at <code lang='und' xml:lang='und'>PC + X</code>.</dd><p class="pad"></p>

<dt><a name="restart_NEXT()"
><b><code lang='und' xml:lang='und'>restart NEXT()</b></code></a></dt><p class="pad"></p>

<dd>Transforms to <code lang='und' xml:lang='und'>PC&#39; = 0</code> and restarts at <code lang='und' xml:lang='und'>PC + S</code>.</dd><p class="pad"></p>

<dt><a name="$n"
><b><code lang='und' xml:lang='und'>$n</b></code></a></dt><p class="pad"></p>

<dd>Transforms to the op function&#39;s nth argument. <code lang='und' xml:lang='und'>$0</code> is the opcode itself.</dd><p class="pad"></p>
</dl>

<p>Note that, for ease of parsing, if the argument to one of the above notations in a ops file contains parentheses, then double the enclosing parentheses and add a space around the argument, like so:</p>

<pre lang='und' xml:lang='und'>    goto OFFSET(( (void*)interp&#45;&#62;happy_place ))</pre>

<h2><a name="Class_Methods"
>Class Methods <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="new(@files)"
><b><code lang='und' xml:lang='und'>new(@files)</b></code></a></dt><p class="pad"></p>

<dd>Returns a new instance initialized by calling <code lang='und' xml:lang='und'>read_ops()</code> on each of the specified op files.</dd><p class="pad"></p>
</dl>

<h2><a name="Instance_Methods"
>Instance Methods <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="read_ops($file,$nolines)"
><b><code lang='und' xml:lang='und'>read_ops($file,$nolines)</b></code></a></dt><p class="pad"></p>

<dd>Reads in the specified .ops file, gathering information about the ops.</dd><p class="pad"></p>

<dt><a
><b><code lang='und' xml:lang='und'>make_op($code, $type, $short_name, $body, $args, $argdirs, $line, $file, $labels, $flags, $nolines)</b></code></a></dt><p class="pad"></p>

<dd>Returns a new <code lang='und' xml:lang='und'><a href='Op.pm.html'>Parrot::Op</a></code> instance for the specified arguments.</dd><p class="pad"></p>

<dt><a name="expand_args(@args)"
><b><code lang='und' xml:lang='und'>expand_args(@args)</b></code></a></dt><p class="pad"></p>

<dd>Given an argument list, returns a list of all the possible argument combinations.</dd><p class="pad"></p>

<dt><a name="ops()"
><b><code lang='und' xml:lang='und'>ops()</b></code></a></dt><p class="pad"></p>

<dd>Returns the <code lang='und' xml:lang='und'><a href='Op.pm.html'>Parrot::Op</a></code> instances found in the file(s).</dd><p class="pad"></p>

<dt><a name="op($index)"
><b><code lang='und' xml:lang='und'>op($index)</b></code></a></dt><p class="pad"></p>

<dd>Returns the op at <code lang='und' xml:lang='und'>$index</code>.</dd><p class="pad"></p>

<dt><a name="preamble()"
><b><code lang='und' xml:lang='und'>preamble()</b></code></a></dt><p class="pad"></p>

<dt><a name="preamble($trans)"
><b><code lang='und' xml:lang='und'>preamble($trans)</b></code></a></dt><p class="pad"></p>

<dd>Returns any lines found prior to first op definition.</dd><p class="pad"></p>

<dd>If <code lang='und' xml:lang='und'>$trans</code> (an <code lang='und' xml:lang='und'><a href='OpTrans.pm.html'>Parrot::OpTrans</a></code> subclass) is supplied then substitutions are made.</dd><p class="pad"></p>

<dt><a name="version($major,_$minor,_$patch)"
><b><code lang='und' xml:lang='und'>version($major, $minor, $patch)</b></code></a></dt><p class="pad"></p>

<dt><a name="version($version)"
><b><code lang='und' xml:lang='und'>version($version)</b></code></a></dt><p class="pad"></p>

<dt><a name="version()"
><b><code lang='und' xml:lang='und'>version()</b></code></a></dt><p class="pad"></p>

<dd>Sets/gets the version number.</dd><p class="pad"></p>

<dt><a name="major_version()"
><b><code lang='und' xml:lang='und'>major_version()</b></code></a></dt><p class="pad"></p>

<dd>Returns the major version number.</dd><p class="pad"></p>

<dt><a name="minor_version()"
><b><code lang='und' xml:lang='und'>minor_version()</b></code></a></dt><p class="pad"></p>

<dd>Returns the minor version number.</dd><p class="pad"></p>

<dt><a name="patch_version()"
><b><code lang='und' xml:lang='und'>patch_version()</b></code></a></dt><p class="pad"></p>

<dd>Returns the patch version number.</dd><p class="pad"></p>

<dt><a name="push_op($op)"
><b><code lang='und' xml:lang='und'>push_op($op)</b></code></a></dt><p class="pad"></p>

<dd>Adds <code lang='und' xml:lang='und'>$op</code> to the end of the op list.</dd><p class="pad"></p>
</dl>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<dl>
<dt><a name="Parrot::Op"
><b><code lang='und' xml:lang='und'><a href='Op.pm.html'>Parrot::Op</a></b></code></a></dt><p class="pad"></p>

<dt><a name="Parrot::OpTrans"
><b><code lang='und' xml:lang='und'><a href='OpTrans.pm.html'>Parrot::OpTrans</a></b></code></a></dt><p class="pad"></p>

<dt><a name="tools/build/ops2c.pl"
><em lang='und' xml:lang='und'><a href="../../tools/build/ops2c.pl.html">tools/build/ops2c.pl</a></em></a></dt><p class="pad"></p>

<dt><a name="tools/build/ops2pm.pl"
><em lang='und' xml:lang='und'><a href="../../tools/build/ops2pm.pl.html">tools/build/ops2pm.pl</a></em></a></dt><p class="pad"></p>

<dt><a name="tools/build/pbc2c.pl"
><em lang='und' xml:lang='und'>tools/build/pbc2c.pl</em></a></dt><p class="pad"></p>
</dl>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
