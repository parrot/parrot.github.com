<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>Handling Small Object Pools</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Handling Small Object Pools</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../html/index.html">Contents</a> | <a href="../../../html/c.html">C</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>src/gc/resources.c &#45; Handling Small Object Pools</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>Handles the accessing of small object pools (header pools).</p>

<h2><a name="Functions"
>Functions <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="INTVAL_contained_in_pool"
><b><code lang='und' xml:lang='und'>INTVAL contained_in_pool</b></code></a></dt><p class="pad"></p>

<dd>Returns whether the given <code lang='und' xml:lang='und'>*ptr</code> points to a location in <code lang='und' xml:lang='und'>pool</code>.</dd><p class="pad"></p>

<dt><a name="int_Parrot_is_const_pmc"
><b><code lang='und' xml:lang='und'>int Parrot_is_const_pmc</b></code></a></dt><p class="pad"></p>

<dd>Returns whether <code lang='und' xml:lang='und'>*pmc</code> is a constant PMC.
The given pointer is a constant PMC if it points into the constant PMC pool.</dd><p class="pad"></p>

<dt><a name="static_void_more_traceable_objects"
><b><code lang='und' xml:lang='und'>static void more_traceable_objects</b></code></a></dt><p class="pad"></p>

<dd>We&#39;re out of traceable objects.
First we try a DOD run to free some up.
If that doesn&#39;t work,
allocate a new arena.</dd><p class="pad"></p>

<dt><a name="static_void_gc_ms_add_free_pmc_ext"
><b><code lang='und' xml:lang='und'>static void gc_ms_add_free_pmc_ext</b></code></a></dt><p class="pad"></p>

<dd>Add a freed PMC_EXT structure to the free list in the PMC_EXT pool.
Objects on the free list can be reused later.</dd><p class="pad"></p>

<dt><a name="static_void_gc_ms_add_free_object"
><b><code lang='und' xml:lang='und'>static void gc_ms_add_free_object</b></code></a></dt><p class="pad"></p>

<dd>Add an unused object back to the pool&#39;s free list for later reuse.
Set the PObj flags to indicate that the item is free.</dd><p class="pad"></p>

<dt><a name="static_void_*_gc_ms_get_free_object"
><b><code lang='und' xml:lang='und'>static void *gc_ms_get_free_object</b></code></a></dt><p class="pad"></p>

<dd>Free object allocator for the MS garbage collector system.
If there are no free objects,
call <code lang='und' xml:lang='und'>gc_ms_add_free_object</code> to either free them up with a DOD run,
or allocate new objects.
If there are objects available on the free list,
pop it off and return it.</dd><p class="pad"></p>

<dt><a name="static_void_*_gc_ms_get_free_pmc_ext"
><b><code lang='und' xml:lang='und'>static void *gc_ms_get_free_pmc_ext</b></code></a></dt><p class="pad"></p>

<dd>Get a new PMC_EXT structure from the free pool and return it.</dd><p class="pad"></p>

<dt><a name="void_Parrot_add_to_free_list"
><b><code lang='und' xml:lang='und'>void Parrot_add_to_free_list</b></code></a></dt><p class="pad"></p>

<dd>Adds the objects in the newly allocated <code lang='und' xml:lang='und'>arena</code> to the free list.</dd><p class="pad"></p>

<dt><a name="void_Parrot_append_arena_in_pool"
><b><code lang='und' xml:lang='und'>void Parrot_append_arena_in_pool</b></code></a></dt><p class="pad"></p>

<dd>Insert the new arena into the pool&#39;s structure.
Arenas are stored in a linked list,
so add the new arena to the list.
Set information in the arenas structure,
such as the number of objects allocated in it.</dd><p class="pad"></p>

<dt><a name="static_void_gc_ms_alloc_objects"
><b><code lang='und' xml:lang='und'>static void gc_ms_alloc_objects</b></code></a></dt><p class="pad"></p>

<dd>New arena allocator function for the MS garbage collector system.
Allocates and initializes a new memory arena in the given pool.
Adds all the new objects to the pool&#39;s free list for later allocation.</dd><p class="pad"></p>

<dt><a name="Small_Object_Pool_*_new_small_object_pool"
><b><code lang='und' xml:lang='und'>Small_Object_Pool *new_small_object_pool</b></code></a></dt><p class="pad"></p>

<dd>Creates a new <code lang='und' xml:lang='und'>Small_Object_Pool</code> and returns a pointer to it.
Initializes the pool structure based on the size of objects in the pool and the number of items to allocate in each arena.</dd><p class="pad"></p>

<dt><a name="void_gc_pmc_ext_pool_init"
><b><code lang='und' xml:lang='und'>void gc_pmc_ext_pool_init</b></code></a></dt><p class="pad"></p>

<dd>Initialize the PMC_EXT pool functions.
This is done separately from other pools.</dd><p class="pad"></p>

<dt><a name="static_void_gc_ms_pool_init"
><b><code lang='und' xml:lang='und'>static void gc_ms_pool_init</b></code></a></dt><p class="pad"></p>

<dd>Initialize a memory pool for the MS garbage collector system.
Sets the function pointers necessary to perform basic operations on a pool,
such as object allocation.</dd><p class="pad"></p>

<dt><a name="void_Parrot_gc_ms_init"
><b><code lang='und' xml:lang='und'>void Parrot_gc_ms_init</b></code></a></dt><p class="pad"></p>

<dd>Initialize the state structures of the gc system.
Called immediately before creation of memory pools.
This function must set the function pointers for <code lang='und' xml:lang='und'>add_free_object_fn</code>,
<code lang='und' xml:lang='und'>get_free_object_fn</code>,
<code lang='und' xml:lang='und'>alloc_object_fn</code>,
and <code lang='und' xml:lang='und'>more_object_fn</code>.</dd><p class="pad"></p>

<dt><a name="void_Parrot_small_object_pool_merge"
><b><code lang='und' xml:lang='und'>void Parrot_small_object_pool_merge</b></code></a></dt><p class="pad"></p>

<dd>Merge pool <code lang='und' xml:lang='und'>source</code> into pool <code lang='und' xml:lang='und'>dest</code>.
Combines the free lists directly,
moves all arenas to the new pool,
and remove the old pool.
To merge,
the two pools must have the same object size,
and the same name (if they have names).</dd><p class="pad"></p>
</dl>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p><em lang='und' xml:lang='und'>include/parrot/smallobject.h</em>,
<em lang='und' xml:lang='und'><a href="../../docs/memory_internals.pod.html">docs/memory_internals.pod</a></em>.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
