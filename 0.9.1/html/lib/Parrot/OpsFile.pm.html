<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Ops To C Code Generation</title>
        <link rel="stylesheet" type="text/css"
            href="../../../resources/parrot.css"
            media="all">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    </head>
    <body>
        <div id="wrapper">
            <div id="header">

                <img border=0 src="../../../resources/parrot_logo.png" id="logo" alt="parrot">
            </div> <!-- "header" -->
            <div id="divider"></div>
            <div id="mainbody">
                <div id="breadcrumb">
                    <a href="../../../html/index.html">Contents</a> &raquo; <a href="../../../html/perl.html">Perl Modules</a> &raquo; Ops To C Code Generation
                </div>

<h1><a name="NAME"
>NAME</a></h1>

<p>Parrot::OpsFile &#45; Ops To C Code Generation</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>  use Parrot::OpsFile;</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p><code>Parrot::OpsFile</code> takes one or more files of op functions and creates real C code for them.</p>

<p>This class is used by <em><a href="../../tools/build/ops2c.pl.html">tools/build/ops2c.pl</a></em>, <em><a href="../../tools/build/ops2pm.pl.html">tools/build/ops2pm.pl</a></em> and <em>tools/build/pbc2c.pl</em>.</p>

<h2><a name="Op_Functions"
>Op Functions</a></h2>

<p>For ops that have trivial bodies (such as just a call to some other function and a <code>return</code> statement), opcode functions are in the format:</p>

<pre>    inline op opname (args) :flags {
        ... body of function ...
    }</pre>

<p>Note that currently the <code>inline</code> op type is ignored.</p>

<p>Alternately, for opcode functions that have more internal complexity the format is:</p>

<pre>    op opname (args) :flags {
        ... body of function ...
    }</pre>

<p>There may be more than one <code>return</code>.</p>

<p>In both cases the closing brace <b>must</b> be on its own line.</p>

<p>When specifying multiple flags, each flag gets its own prefixing colon.</p>

<h2><a name="Op_Arguments"
>Op Arguments</a></h2>

<p>Op arguments are a comma&#45;separated list of direction and type pairs.</p>

<p>Argument direction is one of:</p>

<pre>    in            the argument passes a value into the op
    out           the argument passes a value out of the op
    inout         the argument passes a value into and out of the op
    inconst       the argument passes a constant value into the op
    invar         the argument passes a variable value into the op</pre>

<p>Argument direction is used to determine the life times of symbols and their related register allocations. When an argument is passed into an op a register is read from, when it&#39;s passed out of an op a register is written to.</p>

<p>Argument type is one of:</p>

<pre>    INT       the argument is an integer
    NUM       the argument is an numeric
    STR       the argument is an string
    PMC       the argument is an PMC
    KEY       the argument is an aggregate PMC key
    INTKEY    the argument is an aggregate PMC integer key
    LABEL     the argument is an integer branch offset or address</pre>

<p>The size of the return offset is determined from the op function&#39;s signature.</p>

<h2><a name="Op_Flags"
>Op Flags</a></h2>

<p>The flags are of two types:</p>

<dl>
<dt><a name="1_class"
>1 class</a></dt>
The classification of ops is intended to facilitate the selection of suitable ops for a Parrot safe mode.
<dt><a name="2_behavior"
>2 behavior</a></dt>
The presence (or absence) of certain flags will change how the op behaviors. For example, the lack of the <code>flow</code> flag will cause the op to be implicitly terminated with <code>goto NEXT()</code>. (See next section).The :deprecated flag will generate a diagnostic to standard error at runtime when a deprecated opcode is invoked and <code>PARROT_WARNINGS_DEPRECATED_FLAG</code> has been set.</dl>

<h2><a name="Op_Body_(Macro_Substitutions)"
>Op Body (Macro Substitutions)</a></h2>

<p>In the following macro descriptions, <code>PC</code> and <code>PC&#39;</code> are the current and next position within the Parrot code.</p>

<dl>
<dt><a name="goto_OFFSET(X)"
><b><code>goto OFFSET(X)</b></code></a></dt>
Transforms to <code>PC&#39; = PC + X</code>. This is used for branches.
<dt><a name="goto_NEXT()"
><b><code>goto NEXT()</b></code></a></dt>
Transforms to <code>PC&#39; = PC + S</code>, where <code>S</code> is the size of an op.
<dt><a name="goto_ADDRESS(X)"
><b><code>goto ADDRESS(X)</b></code></a></dt>
Transforms to <code>PC&#39; = X</code>. This is used for absolute jumps.
<dt><a name="goto_POP()"
><b><code>goto POP()</b></code></a></dt>
Transforms to <code>PC&#39; = &#60;pop&#62;</code>. Pops the address off control stack.
<dt><a name="expr_OFFSET(X)"
><b><code>expr OFFSET(X)</b></code></a></dt>
Transforms to <code>PC + X</code>. This is used to give a relative address.
<dt><a name="expr_NEXT()"
><b><code>expr NEXT()</b></code></a></dt>
Transforms to <code>PC + S</code>, the position of the next op.
<dt><a name="expr_ADDRESS(X)"
><b><code>expr ADDRESS(X)</b></code></a></dt>
Transforms to <code>X</code>, an absolute address.
<dt><a name="OP_SIZE"
><b><code>OP_SIZE</b></code></a></dt>
Transforms to <code>S</code>, the size of an op.
<dt><a name="HALT()"
><b><code>HALT()</b></code></a></dt>
Transforms to <code>PC&#39; = 0</code>. Halts run loop, and resets the current position to the start of the Parrot code, without resuming.
<dt><a name="restart_OFFSET(X)"
><b><code>restart OFFSET(X)</b></code></a></dt>
Transforms to <code>PC&#39; = 0</code> and restarts at <code>PC + X</code>.
<dt><a name="restart_NEXT()"
><b><code>restart NEXT()</b></code></a></dt>
Transforms to <code>PC&#39; = 0</code> and restarts at <code>PC + S</code>.
<dt><a name="$n"
><b><code>$n</b></code></a></dt>
Transforms to the op function&#39;s nth argument. <code>$0</code> is the opcode itself.</dl>

<p>Note that, for ease of parsing, if the argument to one of the above notations in a ops file contains parentheses, then double the enclosing parentheses and add a space around the argument, like so:</p>

<pre>    goto OFFSET(( (void*)interp&#45;&#62;happy_place ))</pre>

<h2><a name="Class_Methods"
>Class Methods</a></h2>

<dl>
<dt><a name="new(@files)"
><b><code>new(@files)</b></code></a></dt>
Returns a new instance initialized by calling <code>read_ops()</code> on each of the specified op files.</dl>

<h2><a name="Instance_Methods"
>Instance Methods</a></h2>

<dl>
<dt><a name="read_ops($file,$nolines)"
><b><code>read_ops($file,$nolines)</b></code></a></dt>
Reads in the specified .ops file, gathering information about the ops.
<dt><a name="make_op($code,_$type,_$short_name,_$body,_$args,_$argdirs,_$line,_$file,_$labels,_$flags,_$nolines)"
><b><code>make_op($code, $type, $short_name, $body, $args, $argdirs, $line, $file, $labels, $flags, $nolines)</b></code></a></dt>
Returns a new <code><a href='Op.pm.html'>Parrot::Op</a></code> instance for the specified arguments.
<dt><a name="expand_args(@args)"
><b><code>expand_args(@args)</b></code></a></dt>
Given an argument list, returns a list of all the possible argument combinations.
<dt><a name="ops()"
><b><code>ops()</b></code></a></dt>
Returns the <code><a href='Op.pm.html'>Parrot::Op</a></code> instances found in the file(s).
<dt><a name="op($index)"
><b><code>op($index)</b></code></a></dt>
Returns the op at <code>$index</code>.
<dt><a name="preamble()"
><b><code>preamble()</b></code></a></dt>

<dt><a name="preamble($trans)"
><b><code>preamble($trans)</b></code></a></dt>
Returns any lines found prior to first op definition.If <code>$trans</code> (an <code><a href='OpTrans.pm.html'>Parrot::OpTrans</a></code> subclass) is supplied then substitutions are made.
<dt><a name="version($major,_$minor,_$patch)"
><b><code>version($major, $minor, $patch)</b></code></a></dt>

<dt><a name="version($version)"
><b><code>version($version)</b></code></a></dt>

<dt><a name="version()"
><b><code>version()</b></code></a></dt>
Sets/gets the version number.
<dt><a name="major_version()"
><b><code>major_version()</b></code></a></dt>
Returns the major version number.
<dt><a name="minor_version()"
><b><code>minor_version()</b></code></a></dt>
Returns the minor version number.
<dt><a name="patch_version()"
><b><code>patch_version()</b></code></a></dt>
Returns the patch version number.
<dt><a name="push_op($op)"
><b><code>push_op($op)</b></code></a></dt>
Adds <code>$op</code> to the end of the op list.</dl>

<h1><a name="SEE_ALSO"
>SEE ALSO</a></h1>

<dl>
<dt><a name="Parrot::Op"
><b><code><a href='Op.pm.html'>Parrot::Op</a></b></code></a></dt>

<dt><a name="Parrot::OpTrans"
><b><code><a href='OpTrans.pm.html'>Parrot::OpTrans</a></b></code></a></dt>

<dt><a name="tools/build/ops2c.pl"
><em><a href="../../tools/build/ops2c.pl.html">tools/build/ops2c.pl</a></em></a></dt>

<dt><a name="tools/build/ops2pm.pl"
><em><a href="../../tools/build/ops2pm.pl.html">tools/build/ops2pm.pl</a></em></a></dt>

<dt><a name="tools/build/pbc2c.pl"
><em>tools/build/pbc2c.pl</em></a></dt>
</dl>
            </div> <!-- "mainbody" -->
            <div id="divider"></div>
            <div id="footer">
	        Copyright &copy; 2002-2009, Parrot Foundation.
            </div>
        </div> <!-- "wrapper" -->
    </body>
</html>
