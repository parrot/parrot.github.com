<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Preempt STDIN during testing.</title>
        <link rel="stylesheet" type="text/css"
            href="../../../../../../../resources/parrot.css"
            media="all">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    </head>
    <body>
        <div id="wrapper">
            <div id="header">

                <img border=0 src="../../../../../../../resources/parrot_logo.png" id="logo" alt="parrot">
            </div> <!-- "header" -->
            <div id="divider"></div>
            <div id="mainbody">
                <div id="breadcrumb">
                    <a href="../../../../../../../html/index.html">Contents</a> &raquo; <a href="../../../../../../../html/tests.html">Tests</a> &raquo; Preempt STDIN during testing.
                </div>

<h1><a name="NAME"
>NAME</a></h1>

<p>Tie::Filehandle::Preempt::Stdin &#45; Preempt STDIN during testing.</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS</a></h1>

<pre>    use Tie::Filehandle::Preempt::Stdin;
    @prompts = qw| alpha beta gamma |;
    $object = tie *STDIN, &#39;Tie::Filehandle::Preempt::Stdin&#39;, @prompts;</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>Suppose a program requires manual input from the keyboard operator. How do we test that we have properly handled operator input? More specifically, how do we incorporate testing for user input in files built on Perl&#39;s standard testing apparatus (<code>Test::Simple</code>, <code>Test::More</code>, etc.)?</p>

<p>Tie::Filehandle::Preempt::Stdin offers one way to do it &#45;&#45; a relatively simple and unsophisticated todo it. The most difficult part is analyzing the program to be tested so that you recognize all the points at which input is needed via STDIN. This in turn requires an understanding of all the different branches your program flow can take in response to standard input. Once you know that, you construct a list of dummy data that will be fed to each test at the points the program, when put into production, would normally prompt for operator input. This list of dummy data &#39;pre&#45;empts&#39; standard input via a tie of filehandle STDIN; hence, the module&#39;s name.</p>

<h1><a name="USAGE"
>USAGE</a></h1>

<pre>    @prompts = qw| alpha beta gamma |;
    $object = tie *STDIN, &#39;Tie::Filehandle::Preempt::Stdin&#39;, @prompts;

    print &#34;Enter item 1:  &#34;;
    chomp($entry = &#60;STDIN&#62;);
    # &#39;alpha&#39; is supplied in lieu of standard input;
    # do something with $entry

    print &#34;Enter item 2:  &#34;;
    chomp($entry = &#60;STDIN&#62;);
    # &#39;beta&#39; is supplied in lieu of standard input;
    # do something with $entry

    print &#34;Enter item 3:  &#34;;
    chomp($entry = &#60;STDIN&#62;);
    # &#39;gamma&#39; is supplied in lieu of standard input;
    # do something with $entry</pre>

<p>Should the number of elements in <code>@prompts</code> be less than the number of points at which a given test prompts for operator input, you will get an error message:</p>

<pre>    &#34;List of prompt responses has been exhausted&#34;</pre>

<p>and the program will <code>croak</code>.</p>

<h1><a name="BUGS"
>BUGS</a></h1>

<p>Tie::Filehandle::Preempt::Stdin does not work properly when the source code being tested uses only the Perl diamond operator for standard input.</p>

<pre>    print &#34;Enter room whose data you wish to enter:  &#34;;
    chomp ($try = &#60;&#62;);</pre>

<p>This doesn&#39;t work; your program will hang. You have to hard&#45;code <code>STDIN</code> instead.</p>

<pre>    chomp ($try = &#60;STDIN&#62;);</pre>

<p>I don&#39;t know why this happens. If this bothers you, look at <code>IO::Scalar</code> which is reported to handle the diamond operator properly, but which, IMHO, has a more complex interface.</p>

<h1><a name="SUPPORT"
>SUPPORT</a></h1>

<p>Contact author or post on perl.qa@perl.org.</p>

<h1><a name="AUTHOR"
>AUTHOR</a></h1>

<p>James E Keenan. CPAN ID: JKEENAN. Mail to: jkeenan [at] cpan [dot] org.</p>

<h1><a name="ACKNOWLEDGEMENTS"
>ACKNOWLEDGEMENTS</a></h1>

<p>The author benefitted from &#45;&#45; but did not always agree with &#45;&#45; comments from the following members of Perlmonks: chromatic, Revelation, tmoertel, NiJo and dragonchild.</p>

<p>Thanks to Michael G Schwern and Kevin Scaldeferri for answering questions on the perl.qa mailing list.</p>

<h1><a name="COPYRIGHT"
>COPYRIGHT</a></h1>

<p>Copyright 2005 James E Keenan. This program is free software; you can redistribute it and/or modify it under the same terms as Perl itself.</p>

<p>The full text of the license can be found in the LICENSE file included with this module.</p>

<p>Last revision: Apr 17 2005.</p>

<h1><a name="SEE_ALSO"
>SEE ALSO</a></h1>

<p>perltie(1).</p>

<p><i>Programming Perl</i> (3rd ed.), Larry Wall, Tom Christiansen and Jon Orwant. O&#39;Reilly &#38; Associates, 1991. Chapter 14: Tied Variables: section on &#39;&#39;Tying Filehandles,&#39;&#39; p. 384 ff.</p>

<p>Perlmonks discussion starting at: <a href='http://www.perlmonks.org/index.pl?node_id=430997'><a href="http://www.perlmonks.org/index.pl?node_id=430997">http://www.perlmonks.org/index.pl?node_id=430997</a></a>.</p>

<p>Postings on perl.qa at: <a href='http://www.nntp.perl.org/group/perl.qa/4074'><a href="http://www.nntp.perl.org/group/perl.qa/4074">http://www.nntp.perl.org/group/perl.qa/4074</a></a> and <a href='http://www.nntp.perl.org/group/perl.qa/4076'><a href="http://www.nntp.perl.org/group/perl.qa/4076">http://www.nntp.perl.org/group/perl.qa/4076</a></a>.</p>
            </div> <!-- "mainbody" -->
            <div id="divider"></div>
            <div id="footer">
	        Copyright &copy; 2002-2009, Parrot Foundation.
            </div>
        </div> <!-- "wrapper" -->
    </body>
</html>
