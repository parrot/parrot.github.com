<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Untitled</title>
        <link rel="stylesheet" type="text/css"
            href="../../../../resources/parrot.css"
            media="all">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    </head>
    <body>
        <div id="wrapper">
            <div id="header">

                <img border=0 src="../../../../resources/parrot_logo.png" id="logo" alt="parrot">
            </div> <!-- "header" -->
            <div id="divider"></div>
            <div id="mainbody">
                <div id="breadcrumb">
                    <a href="../../../../html/index.html">Contents</a> &raquo; <a href="../../../../html/languages.html">Language Implementations</a> &raquo; <a href="../../../../html/dotnet.html">.Net</a> &raquo; Untitled
                </div>

<h1><a name="The_.NET_Metadata_To_PIR_Translator"
>The .NET Metadata To PIR Translator</a></h1>

<p>Much data about .NET classes along with their fields and methods are stored in tables,
collectively known as metadata,
outside of the instruction stream.
A number of PMCs (documented in <a href='TODO'>pmcs.pod</a>) are used to access this metadata.</p>

<h2><a name="Interface"
>Interface</a></h2>

<p>This subsystem represents itself as a single sub that takes a single parameter,
the filename of the EXE or DLL file with CLI metadata inside it that needs to be translated.
It returns the PIR of the translated file.
The sub is simply named &#34;dotnet_to_pir&#34;.</p>

<pre>  pir = dotnet_to_pir(filename)</pre>

<p>This is contained in the file &#34;src/translator.pir&#34;.</p>

<h2><a name="Guts"
>Guts</a></h2>

<p>This section describes the internals of the metadata translator.</p>

<h3><a name="Flow"
>Flow</a></h3>

<h4><a name="Assemblies,_Classes,_Fields_and_Methods"
>Assemblies, Classes, Fields and Methods</a></h4>

<pre>                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |        dotnet_to_pir       |
                   |       (translator.pir)     |
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                               _||_
                               \  /
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |         trans_class        |
                   |       (translator.pir)     |
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                 ==================================
                ||                                ||
               _||_                              _||_
               \  /                              \  /
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
      |     trans_field      |          |     trans_method     |
      |   (translator.pir)   |          |     (method.pir)     |
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                                  ||
                                                 _||_
                                                 \  /
                                                  \/
                                               See below</pre>

<h4><a name="Method_Translation_Details"
>Method Translation Details</a></h4>

<pre>                             See above
                                ||
                               _||_
                               \  /
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |         trans_method       |&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;|\ Instruction
                   |         (method.pir)       |&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;|/ Translator
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                 ==================================
                ||                                ||
               _||_                              _||_
               \  /                              \  /
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
      | trans_method_params  |          | trans_method_locals  |
      |     (method.pir)     |          |     (method.pir)     |
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                ||                                ||
               _||_                              _||_
               \  /                              \  /
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
      |    get_signature_    |          |    get_signature_    |
      |   RetType_or_Param   |          |        Local         |
      |    (signature.pir)   |          |    (signature.pir)   |
      +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+</pre>

<h3><a name="Files"
>Files</a></h3>

<p>The translator source consists of a number of PIR files.</p>

<h4><a name="translator.pir"
>translator.pir</a></h4>

<p>This contains the main dotnet_to_pir sub that initiates the translation process. It also contains translate_class, which drives translation of a .NET class, and translate_field, which translates a field.</p>

<h4><a name="method.pir"
>method.pir</a></h4>

<p>This contains routines related to translating methods along with their local variables and parameters. The sub translate_method drives this, using a couple of utility functions. It also makes use of signature translation routines in signature.pir.</p>

<h4><a name="signature.pir"
>signature.pir</a></h4>

<p>This contains routines that parse parts of signature blobs and build some simple data structures out of them.</p>
            </div> <!-- "mainbody" -->
            <div id="divider"></div>
            <div id="footer">
	        Copyright &copy; 2002-2009, Parrot Foundation.
            </div>
        </div> <!-- "wrapper" -->
    </body>
</html>
