<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Multimethod dispatch for binary opcode functions</title>
        <link rel="stylesheet" type="text/css"
            href="../../resources/parrot.css"
            media="all">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    </head>
    <body>
        <div id="wrapper">
            <div id="header">

                <img border=0 src="../../resources/parrot_logo.png" id="logo" alt="parrot">
            </div> <!-- "header" -->
            <div id="divider"></div>
            <div id="mainbody">
                <div id="breadcrumb">
                    <a href="../../html/index.html">Contents</a> &raquo; <a href="../../html/c.html">C</a> &raquo; Multimethod dispatch for binary opcode functions
                </div>

<h1><a name="NAME"
>NAME</a></h1>

<p>src/multidispatch.c &#45; Multimethod dispatch for binary opcode functions</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS</a></h1>

<p>This system is set up to handle type&#45;based dispatching for binary (two argument) functions.
This includes,
though isn&#39;t necessarily limited to,
binary operators such as addition or subtraction.</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>The MMD system is straightforward,
and currently must be explicitly invoked,
for example by a vtable function.
(We reserve the right to use MMD in all circumstances,
but currently do not).</p>

<h2><a name="API"
>API</a></h2>

<p>For the purposes of the API,
each MMD&#45;able function is assigned a unique number which is used to find the correct function table.
This is the <code>func_num</code> parameter in the following functions.
While Parrot isn&#39;t restricted to a predefined set of functions,
it <i>does</i> set things up so that all the binary vtable functions have a MMD table preinstalled for them,
with default behaviour.</p>

<h2><a name="Remarks"
>Remarks</a></h2>

<p><code>binop_mmd_funcs&#45;&#62;x</code> and <code>&#45;&#62;y</code> are table sizes not highest type in table.</p>

<h2><a name="Functions"
>Functions</a></h2>

<dl>
<dt><a name="PMC*_Parrot_mmd_find_multi_from_sig_obj"
><b><code>PMC *Parrot_mmd_find_multi_from_sig_obj</b></code></a></dt>
Collect a list of possible candidates for a given sub name and call signature.
Rank the possible candidates by Manhattan Distance,
and return the best matching candidate.
The candidate list is cached in the CallSignature object,
to allow for iterating through it.Currently this only looks in the global &#34;MULTI&#34; namespace.
<dt><a name="void_Parrot_mmd_multi_dispatch_from_c_args"
><b><code>void Parrot_mmd_multi_dispatch_from_c_args</b></code></a></dt>
Dispatches to a MultiSub from a variable&#45;sized list of C arguments.
The multiple dispatch system will figure out which sub should be called based on the types of the arguments passed in.Return arguments must be passed as a reference to the PMC,
string,
number,
or integer,
so the result can be set.
<dt><a name="PMC_*_Parrot_mmd_find_multi_from_long_sig"
><b><code>PMC *Parrot_mmd_find_multi_from_long_sig</b></code></a></dt>
Find the best candidate multi for a given sub name and signature.
The signature is a string containing a comma&#45;delimited list of type names.Currently only searches the global MULTI namespace.
<dt><a name="PMC_*_Parrot_mmd_sort_manhattan_by_sig_pmc"
><b><code>PMC *Parrot_mmd_sort_manhattan_by_sig_pmc</b></code></a></dt>
Given an array PMC (usually a MultiSub) and a CallSignature PMC,
sorts the mmd candidates by their manhattan distance to the signature args and returns the best one.
<dt><a name="PMC_*_Parrot_mmd_sort_manhattan"
><b><code>PMC *Parrot_mmd_sort_manhattan</b></code></a></dt>
Given an array PMC (usually a MultiSub) sorts the mmd candidates by their manhattan distance to the current args and returns the best one.
<dt><a name="static_PMC*_Parrot_mmd_arg_tuple_func"
><b><code>static PMC *Parrot_mmd_arg_tuple_func</b></code></a></dt>
Return a list of argument types.
PMC arguments are taken from registers according to calling conventions.
<dt><a name="static_void_Parrot_mmd_search_classes"
><b><code>static void Parrot_mmd_search_classes</b></code></a></dt>
Search all the classes in all MultiSubs of the candidates <code>cl</code> and return a list of all candidates.
<code>start_at_parent</code> is 0 to start at the class itself or 1 to search from the first parent class.
<dt><a name="static_INTVAL_distance_cmp"
><b><code>static INTVAL distance_cmp</b></code></a></dt>
RT #48260: Not yet documented!!!
<dt><a name="static_PMC*_mmd_build_type_tuple_from_type_list"
><b><code>static PMC *mmd_build_type_tuple_from_type_list</b></code></a></dt>
Construct a FixedIntegerArray of type numbers from an array of type names.
Used for multiple dispatch.
<dt><a name="static_PMC*_mmd_build_type_tuple_from_long_sig"
><b><code>static PMC *mmd_build_type_tuple_from_long_sig</b></code></a></dt>
Construct a FixedIntegerArray of type numbers from a comma&#45;delimited string of type names.
Used for multiple dispatch.
<dt><a name="PMC*_Parrot_mmd_build_type_tuple_from_sig_obj"
><b><code>PMC *Parrot_mmd_build_type_tuple_from_sig_obj</b></code></a></dt>
Construct a FixedIntegerArray of type numbers from the arguments of a Call Signature object.
Used for multiple dispatch.
<dt><a name="static_PMC*_mmd_cvt_to_types"
><b><code>static PMC *mmd_cvt_to_types</b></code></a></dt>
Given a ResizablePMCArray PMC containing some form of type identifier (either the string name of a class or a PMC representing the type),
resolves all type references to type IDs,
if possible.
If that&#39;s not possible,
returns PMCNULL.
In that case you can&#39;t dispatch to the multi variant with this type signature,
as Parrot doesn&#39;t yet know about the respective types requested &#45;&#45; you have to register them first.Otherwise,
returns a ResizableIntegerArray PMC full of type IDs representing the signature of a multi variant to which you may be able to dispatch.{{**DEPRECATE**}}
<dt><a name="static_UINTVAL_mmd_distance"
><b><code>static UINTVAL mmd_distance</b></code></a></dt>
Create Manhattan Distance of sub <code>pmc</code> against given argument types.
0xffff is the maximum distance
<dt><a name="static_PMC_*_Parrot_mmd_sort_candidates"
><b><code>static PMC *Parrot_mmd_sort_candidates</b></code></a></dt>
Sort the candidate list <code>cl</code> by Manhattan Distance,
returning the best candidate.
<dt><a name="static_PMC*_Parrot_mmd_search_scopes"
><b><code>static PMC *Parrot_mmd_search_scopes</b></code></a></dt>
Search all scopes for MMD candidates matching the arguments given in <code>arg_tuple</code>.
<dt><a name="static_int_mmd_maybe_candidate"
><b><code>static int mmd_maybe_candidate</b></code></a></dt>
If the candidate <code>pmc</code> is a Sub PMC,
push it on the candidate list and return TRUE to stop further search.If the candidate is a MultiSub remember all matching Subs and return FALSE to continue searching outer scopes.
<dt><a name="static_int_mmd_search_local"
><b><code>static int mmd_search_local</b></code></a></dt>
Search the current package namespace for matching candidates.
Return TRUE if the MMD search should stop.
<dt><a name="static_void_mmd_search_by_sig_obj"
><b><code>static void mmd_search_by_sig_obj</b></code></a></dt>
Search the namespace of the first argument to the sub call for matching candidates.
<dt><a name="static_void_mmd_search_global"
><b><code>static void mmd_search_global</b></code></a></dt>
Search the builtin namespace for matching candidates.
<dt><a name="static_void_mmd_add_multi_global"
><b><code>static void mmd_add_multi_global</b></code></a></dt>
Create a MultiSub,
or add a variant to an existing MultiSub.
The MultiSub is stored in the global MULTI namespace.
<dt><a name="static_void_mmd_add_multi_to_namespace"
><b><code>static void mmd_add_multi_to_namespace</b></code></a></dt>
Create a MultiSub,
or add a variant to an existing MultiSub.
The MultiSub is added as a method to a class.
<dt><a name="void_Parrot_mmd_add_multi_from_long_sig"
><b><code>void Parrot_mmd_add_multi_from_long_sig</b></code></a></dt>
Create a MultiSub,
or add a variant to an existing MultiSub.
The MultiSub is stored in the global MULTI namespace.
<dt><a name="void_Parrot_mmd_add_multi_from_c_args"
><b><code>void Parrot_mmd_add_multi_from_c_args</b></code></a></dt>
Create a MultiSub,
or add a variant to an existing MultiSub.
The MultiSub is stored in the specified namespace.
<dt><a name="void_Parrot_mmd_add_multi_list_from_c_args"
><b><code>void Parrot_mmd_add_multi_list_from_c_args</b></code></a></dt>
Create a collection of multiple dispatch subs from a C structure of information.
Iterate through the list of details passed in.
For each entry create a MultiSub or add a variant to an existing MultiSub.
MultiSubs are created in the global &#39;MULTI&#39; namespace in the Parrot HLL.Typically used to create all the multiple dispatch routines declared in a PMC from the PMC&#39;s class initialization function.
<dt><a name="MMD_Cache_*_Parrot_mmd_cache_create"
><b><code>MMD_Cache *Parrot_mmd_cache_create</b></code></a></dt>
Creates and returns a new MMD cache.
<dt><a name="static_STRING_*_mmd_cache_key_from_values"
><b><code>static STRING *mmd_cache_key_from_values</b></code></a></dt>
Generates an MMD cache key from an array of values.
<dt><a name="PMC_*_Parrot_mmd_cache_lookup_by_values"
><b><code>PMC *Parrot_mmd_cache_lookup_by_values</b></code></a></dt>
Takes an array of values for the call and does a lookup in the MMD cache.
<dt><a name="void_Parrot_mmd_cache_store_by_values"
><b><code>void Parrot_mmd_cache_store_by_values</b></code></a></dt>
Takes an array of values for the call along with a chosen candidate and puts it into the cache.
<dt><a name="static_STRING_*_mmd_cache_key_from_types"
><b><code>static STRING *mmd_cache_key_from_types</b></code></a></dt>
Generates an MMD cache key from an array of types.
<dt><a name="PMC_*_Parrot_mmd_cache_lookup_by_types"
><b><code>PMC *Parrot_mmd_cache_lookup_by_types</b></code></a></dt>
Takes an array of types for the call and does a lookup in the MMD cache.
<dt><a name="void_Parrot_mmd_cache_store_by_types"
><b><code>void Parrot_mmd_cache_store_by_types</b></code></a></dt>
Takes an array of types for the call along with a chosen candidate and puts it into the cache.
The name parameter is optional,
and if the cache is already tied to an individual multi can be null.
<dt><a name="void_Parrot_mmd_cache_mark"
><b><code>void Parrot_mmd_cache_mark</b></code></a></dt>
GC&#45;marks an MMD cache.
<dt><a name="void_Parrot_mmd_cache_destroy"
><b><code>void Parrot_mmd_cache_destroy</b></code></a></dt>
Destroys an MMD cache.</dl>

<h1><a name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><em>include/parrot/multidispatch.h</em>,
<em>http://svn.perl.org/perl6/doc/trunk/design/apo/A12.pod</em>,
<em>http://svn.perl.org/perl6/doc/trunk/design/syn/S12.pod</em></p>
            </div> <!-- "mainbody" -->
            <div id="divider"></div>
            <div id="footer">
	        Copyright &copy; 2002-2009, Parrot Foundation.
            </div>
        </div> <!-- "wrapper" -->
    </body>
</html>
