<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>HTTP server</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">HTTP server</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../html/index.html">Contents</a> | <a href="../../../html/examples.html">Examples</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>examples/io/httpd.pir &#45; HTTP server</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<pre>  $ ./parrot examples/io/httpd.pir</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>A very tiny HTTP&#45;Server. It currently only understands the GET method. It&#39;s a nice way of testing pretty much all IO functions. By default (and not yet configurable) it binds to localhost:1234.</p>

<h2><a name="Serving_Parrot_Docs"
>Serving Parrot Docs <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>If no filename is given it serves the HTML documentation in ./docs/html. Make sure you have built them with</p>

<pre>  $ make html</pre>

<p>After that you can browse the documentation with</p>

<pre>  <a href="http://localhost:1234">http://localhost:1234</a></pre>

<p>which redirects to</p>

<pre>  <a href="http://localhost:1234/docs/html/index.html">http://localhost:1234/docs/html/index.html</a></pre>

<h2><a name="Serving_Other_HTML_Files"
>Serving Other HTML Files <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>If a html file is present in the request, this file will be served:</p>

<pre>  <a href="http://localhost:1234/index.html">http://localhost:1234/index.html</a></pre>

<p>This will sent <em>./index.html</em> from the directory, where <em>httpd.pir</em> was started.</p>

<h2><a name="CGI"
>CGI <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h2>

<p>If the file extension is <code>.pir</code> or <code>.pbc</code>, this file will be loaded below the directory <em>cgi&#45;pir</em> and the function <code>cgi_main</code> will be invoked with the query as an argument. This functions should return a plain string, which will be sent to the browser.</p>

<p><em>cgi_main</em> is called with 3 arguments: a todo/reserved PMC, a string with the original query and a Hash, with <code>key=value</code> items split by <code>&#39;+&#39;</code>. <code>key</code> and <code>value</code> are already <code>urldecoded</code>.</p>

<pre>  $ cat cgi&#45;pir/foo.pir
  .sub cgi_main
    .param pmc reserved         # TODO
    .param string query         # all after &#39;?&#39;:  &#34;foo=1+bar=A&#34;
    .param pmc query_hash       # Hash { foo=&#62;&#39;1&#39;, bar=&#62;&#39;A&#39; }
    .return (&#34;&#60;p&#62;foo&#60;/p&#62;&#34;)      # in practice use a full &#60;html&#62;doc&#60;/html&#62;
                                # unless serving XMLHttpRequest&#39;s
  .end</pre>

<p>The browser request:</p>

<pre>  <a href="http://localhost:1234/foo.pir?foo=1+bar=%61">http://localhost:1234/foo.pir?foo=1+bar=%61</a></pre>

<p>will serve, whatever the <code>cgi_main</code> function returned.</p>

<h1><a name="TODO"
>TODO <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>make it work on W32/IE</p>

<p>Transcode the received string to ascii, in order to have access to an implemented &#39;index&#39; op. Or just use unicode instead.</p>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>RFC2616</p>

<h1><a name="AUTHOR"
>AUTHOR <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>Original author is Markus Amsler &#45; &#60;markus.amsler@oribi.org&#62; The code was heavily hacked by bernhard and leo.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
