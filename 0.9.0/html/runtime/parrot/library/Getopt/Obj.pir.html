<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>parse long and short command line options</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">parse long and short command line options</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../../html/index.html">Contents</a> | <a href="../../../../../html/libs.html">Libraries</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>library/Getopt/Obj.pir &#45; parse long and short command line options</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>.sub main :main .param pmc argv</p>

<pre>    .local string prog_name
    prog_name = shift argv
    load_bytecode &#34;Getopt/Obj.pir&#34;
    .local pmc getopts
    getopts = new &#34;Getopt::Obj&#34;
    getopts.&#34;notOptStop&#34;(1)

     # these two are identical, with the exception of the call to name

     push getopts, &#34;foo|f:s&#34;

     $P0 = getopts.&#34;add&#34;()
     $P0.&#34;name&#34;(&#34;FooBar&#34;)
     $P0.&#34;long&#34;(&#34;foo&#34;)
     $P0.&#34;short&#34;(&#34;f&#34;)
     $P0.&#34;optarg&#34;(1)
     $P0.&#34;type&#34;(&#39;String&#39;)

     # these two are identical

     push getopts, &#34;bar|b=s&#34;

     $P0 = getopts.&#34;add&#34;()
     $P0.&#34;long&#34;(&#34;bar&#34;)
     $P0.&#34;short&#34;(&#34;b&#34;)
     $P0.&#34;type&#34;(&#39;String&#39;)

     .local pmc opts
     opts = getopts.&#34;get_options&#34;(argv)
     .local string foo
     foo = opts[&#34;Foobar&#34;]
 .end</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>This library parses options from the command line. Options may take and of these forms, currently:</p>

<pre> &#45;&#45;foo=bar         Set foo to bar
 &#45;f bar            Set f to bar (with conditions)
 &#45;fthis=that       If f is a Hash, set key &#39;this&#39; to &#39;that&#39;
 &#45;f this=that      If f is a Hash, set key &#39;this&#39; to &#39;that&#39;
 &#45;f                Set f (if it&#39;s Boolean or has an optional argument)
 &#45;fbar             Set f to bar if it&#39;s not a Boolean
 &#45;abc              If &#45;a &#45;b and &#45;c are all Booleans, set them all
 &#45;&#45;foo=this=that   If foo is a Hash, set key &#39;this&#39; to &#39;that&#39;
                   Both equal signs are required
 &#45;&#45;                Stop processing args, &#45;&#45; is removed from argv</pre>

<h1><a name="SUBROUTINES"
>SUBROUTINES <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<dl>
<dt><a name="__load()"
><b><code>__load()</b></code></a></dt>
States that Getopt::Obj and Getopt::Obj::Spec are classes to use and defines the attributes they&#39;ll use.</dl>

<h2><a name="Class_Getopt::Obj"
>Class Getopt::Obj <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h2>

<p>Our nice little module.</p>

<dl>
<dt><a name="init()"
><b><code>init()</b></code></a></dt>
Creates the Specs and notOptStop attribute, interal stuff.
<dt><a name="HASH_get_options(ARRAY_ARGV)"
><b><code>HASH get_options(ARRAY ARGV)</b></code></a></dt>
Parses ARGV, modifying it inplace, and returns a hash with the keys and values wanted.
<dt><a name="__push_string(STRING_format)"
><b><code>__push_string(STRING format)</b></code></a></dt>
A vtable method, invoked by e.g. <code>push getopts, &#34;foo|f=s&#34;</code>. The format is as such.
<dl>
<dt><a name="&#34;foo|f&#34;"
>&#34;foo|f&#34;</a></dt>
A long option of &#34;foo&#34; and a short option of &#34;f&#34; is set to <code>Boolean</code>.
<dt><a name="&#34;foo&#34;"
>&#34;foo&#34;</a></dt>
A long option of &#34;foo&#34; is set to <code>Boolean</code>.
<dt><a name="&#34;f&#34;"
>&#34;f&#34;</a></dt>
A short option of &#34;f&#34; is set to <code>Boolean</code>.
<dt><a name="&#34;f=s&#34;"
>&#34;f=s&#34;</a></dt>
A short option of &#34;f&#34; is set to <code>String</code>. Use <code>i</code> for <code>Integer</code>, <code>f</code> for <code>Float</code>, <code>@</code> for an <code>Array</code>, and <code>%</code> for a <code>Hash</code>.
<dt><a name="&#34;foo:s&#34;"
>&#34;foo:s&#34;</a></dt>
A long option of &#34;foo&#34; is set to <code>String</code>, with &#34;optarg&#34; set to a true value.</dl>

<dt><a name="Getopt::Obj::Spec_add()"
><b><code>Getopt::Obj::Spec add()</b></code></a></dt>
Adds a new option to the parsing. You don&#39;t need to know what class it is (internal data), just that you get an object to invoke methods on.
<dt><a name="STRING_getNameForKey(STRING_key)"
><b><code>STRING getNameForKey(STRING key)</b></code></a></dt>
Given a key, maybe long or short, or when storing, the name itself perhaps, return the name for the key.
<dt><a name="INT_self.&#34;notOptStop&#34;()"
><b><code>INT self.&#34;notOptStop&#34;()</b></code></a></dt>

<dt><a name="INT_self.&#34;notOptStop&#34;(INT_val)"
><b><code>INT self.&#34;notOptStop&#34;(INT val)</b></code></a></dt>
Boolean method, so setting it to 2 is no different than setting it to 1. If notOptStop is set to a true value, then get_options will stop after it reaches an argument not specified by the program. This is either an unrecognized option, such as a mistyped argument, or an argument means to be passed on again later. Or of course, it&#39;s not an argument at all and perhaps a filename.
<dt><a name="MissingRequired(STRING_arg)"
><b><code>MissingRequired(STRING arg)</b></code></a></dt>
When a required argument is missing, throws an exception with the message &#34;Missing a required argument for option &#39;foo&#39;&#34;.</dl>

<h2><a name="Class_Getopt::Obj::Spec"
>Class Getopt::Obj::Spec <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h2>

<p>Interal use only, at least don&#39;t do any new &#34;Getopt::Obj::Spec&#34; yourself... This makes an easy holder for each possible match.</p>

<dl>
<dt><a name="init()"
><b><code>init()</b></code></a></dt>
Set the defaults to all our attributes, more internal stuff. Sets the default &#34;type&#34; to <code>Boolean</code>.
<dt><a name="STRING_self.&#34;name&#34;()"
><b><code>STRING self.&#34;name&#34;()</b></code></a></dt>

<dt><a name="STRING_self.&#34;name&#34;(STRING_val)"
><b><code>STRING self.&#34;name&#34;(STRING val)</b></code></a></dt>
If val is given, set the name to that. If val is not given, return either name, long, or short, in that order. Used for the return key. So if you define only a short option, but want a long name returned, set this. The partial intent of the method is to easily allow having an option have multiple long/short arguments instead of one of each.
<dt><a name="STRING_self.&#34;long&#34;()"
><b><code>STRING self.&#34;long&#34;()</b></code></a></dt>

<dt><a name="STRING_self.&#34;long&#34;(STRING_val)"
><b><code>STRING self.&#34;long&#34;(STRING val)</b></code></a></dt>
If val is given, set the long value to that. If val is not given, return the string set as the long.
<dt><a name="STRING_self.&#34;short&#34;()"
><b><code>STRING self.&#34;short&#34;()</b></code></a></dt>

<dt><a name="STRING_self.&#34;short&#34;(STRING_val)"
><b><code>STRING self.&#34;short&#34;(STRING val)</b></code></a></dt>
If val is given, set the short value to that. If val is not given, return the string set as the short.NOTE: There is no checking to ensure that short is only one character.
<dt><a name="INT_self.&#34;type&#34;()"
><b><code>INT self.&#34;type&#34;()</b></code></a></dt>

<dt><a name="INT_self.&#34;type&#34;(INT_val)"
><b><code>INT self.&#34;type&#34;(INT val)</b></code></a></dt>
If val is given, set the type to that. If val is not given, return the int set as the type.NOTE: It doesn&#39;t verify it&#39;s a correct type.
<dl>
<dt><a name="Boolean"
><b><code>Boolean</b></code></a></dt>
A true/false value, the default.For a short argument, it&#39;s simply <code>&#45;f</code>. Groups of <code>Boolean</code>&#39;s tied together, such as <code>&#45;foobar</code>, if <code>&#45;f</code>, <code>&#45;o</code>, <code>&#45;b</code>, <code>&#45;a</code>, and <code>&#45;r</code> are all <code>Boolean</code> values, then each will be set. If <code>&#45;f</code> is a <code>Boolean</code> but one of the others is not, an exception is thrown.For a long argument, it takes the form <code>&#45;&#45;foo</code>. Usage such as <code>&#45;&#45;foo=this</code> or <code>&#45;&#45;foo=</code> are allowed, but it just sets it to true, so no difference.
<dt><a name="String"
><b><code>String</b></code></a></dt>
A string. This can take the form of <code>&#45;&#45;foo=bar</code>, <code>&#45;f bar</code>, or <code>&#45;fbar</code>.
<dt><a name="Integer"
><b><code>Integer</b></code></a></dt>
An integer, &#45;&#45;foo=3.14 is stored as 3. Type conversions are done by Parrot. Same forms as for <code>String</code>.
<dt><a name="Float"
><b><code>Float</b></code></a></dt>
A float. Same forms apply here as well.
<dt><a name="Array"
><b><code>Array</b></code></a></dt>
An array, done via multiple arguments. For something such as <code>&#45;I./include &#45;I./src/include</code> for example, <code>I</code> will be an array of <code>./include</code> and <code>./src/include</code>. If only used once, it&#39;s a one sized array.
<dt><a name="Hash"
><b><code>Hash</b></code></a></dt>
A hash, such as defines. For a short argument, the form is <code>&#45;Dfoo=bar</code>, <code>&#45;Dfoo</code>, and <code>&#45;&#45;define=foo=bar</code>(both equal signs required).</dl>
Do not hard code the integer values in, for the same reason as the rest of your code. There&#39;s no guarantees they won&#39;t be reassigned.
<dt><a name="INT_self.&#34;optarg&#34;()"
><b><code>INT self.&#34;optarg&#34;()</b></code></a></dt>

<dt><a name="INT_self.&#34;optarg&#34;(INT_val)"
><b><code>INT self.&#34;optarg&#34;(INT val)</b></code></a></dt>
Boolean method, with explicit setting. If optarg is set to a true value, then the argument, e.g. <code>bar</code> in <code>&#45;&#45;foo=bar</code>, is not mandatory. In <code>&#45;fbar</code>, <code>&#45;f</code> is set to <code>bar</code>. In <code>&#45;f bar</code> it is NOT set.</dl>

<h1><a name="TODO"
>TODO <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<ul>
<li>Actually check what&#39;s being passed instead of using type conversions?</li>

<li>Sub type, call a sub for a given argument, with <code>argv</code> and <code>return</code>.</li>

<li>How to handle an unknown arg, currently kept in argv.</li>

<li>Should a lonesome hyphen be a permited value as not an option. Currently kept in argv in case the program wants it, such as indicating stdin or stdout.</li>

<li>For an arg to a short arg, e.g. &#45;C &#45;d, will put &#45;d as the value for &#45;C so long as &#45;C is not a <code>Boolean</code>. Should it be an error?</li>
</ul>

<h1><a name="BUGS"
>BUGS <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<ul>
<li>If an option is considered optional, then with the short name, the next value is not checked for at all. If it&#39;s not optional, it&#39;s checked and all&#39;s well, as described for <code>obj.&#34;type&#34;()</code>.</li>

<p>Not positive this is a bug... And relates to the &#45;f &#45;b issue where if the argument to &#45;f is required, it will be given &#39;&#45;b&#39;.</p>

<li>Bundling of options will only work for <code>Boolean</code> options. So my little &#34;perl pie&#34; annoyance isn&#39;t handled, <code>perl &#45;pie &#34;code&#34;</code>, although perl doesn&#39;t handle it in a DWIM manner...</li>

<p>And it doesn&#39;t have good error correction....</p>
</ul>

<h1><a name="AUTHOR"
>AUTHOR <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Joshua Isom &#45; <code>loneowl@ritalin.shout.net</code></p>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>The <em>library/Getopt/Long.pir</em> Parrot library.</p>

<p><em><a href="../../../../t/library/getopt_obj.t.html">t/library/getopt_obj.t</a></em></p>

<h1><a name="COPYRIGHT"
>COPYRIGHT <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Copyright (C) 2006&#45;2008, The Perl Foundation.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
