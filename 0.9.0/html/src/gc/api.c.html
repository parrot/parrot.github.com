<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>general Parrot API for GC functions</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">general Parrot API for GC functions</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../html/index.html">Contents</a> | <a href="../../../html/c.html">C</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>src/gc/api.c &#45; general Parrot API for GC functions</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>This file implements <i>dead object destruction</i>.
This is documented in PDD 9 with supplementary notes in <em>docs/dev/dod.pod</em> and <em><a href="../../docs/memory_internals.pod.html">docs/memory_internals.pod</a></em>.</p>

<p>It&#39;s possible to turn on/off the checking of the system stack and processor registers.
The actual checking is set up in <em><a href="../cpu_dep.c.html">src/cpu_dep.c</a></em> and is performed in the function <code>trace_memory_block</code> here.</p>

<p>There&#39;s also a verbose mode for garbage collection.</p>

<h1><a name="FUNCTIONS"
>FUNCTIONS <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<dl>
<dt><a name="PMC_*_new_pmc_header"
><b><code>PMC *new_pmc_header</b></code></a></dt>
Gets a new PMC header from the PMC pool&#39;s free list.
Guaranteed to return a valid PMC object or else Parrot will panic.
Sets the necessary flags for the objects and initializes the PMC data pointer to <code>NULL</code>.
<dt><a name="static_PMC_EXT_*_new_pmc_ext"
><b><code>static PMC_EXT *new_pmc_ext</b></code></a></dt>
Gets a new free <code>PMC_EXT</code> structure from the PMC_EXT pool.
A pointer to the new PMC_EXT is returned.
Does not check to ensure the PMC_EXT is non&#45;null before it is returned (yet).
<dt><a name="void_add_pmc_ext"
><b><code>void add_pmc_ext</b></code></a></dt>
Obtains a new <code>PMC_EXT</code> structure,
and attaches it to the given <code>PMC</code>.
Sets the necessary flags associated with the PMC_EXT structure.
Ensures that the PMC_EXT structure is marked as &#34;alive&#34; by the GC.
<dt><a name="void_add_pmc_sync"
><b><code>void add_pmc_sync</b></code></a></dt>
Adds a <code>Sync*</code> structure to the given <code>PMC</code>.
Initializes the PMC&#39;s owner field and the synchronization mutext.
Does not check to ensure the <code>Sync *</code> is non&#45;null.
<dt><a name="STRING_*_new_string_header"
><b><code>STRING *new_string_header</b></code></a></dt>
Returns a new <code>STRING</code> header from the string pool or the constant string pool.
Sets default flags on the string object: <code>PObj_is_string_FLAG</code>,
<code>PObj_is_COWable_FLAG</code>,
and <code>PObj_live_FLAG</code> (for GC).
Initializes the data field of the string buffer to <code>NULL</code>.
<dt><a name="Buffer_*_new_buffer_header"
><b><code>Buffer *new_buffer_header</b></code></a></dt>
Creates and returns a new <code>Buffer</code> from the buffer header pool.
Calls <code>get_free_buffer</code> to do all the work.
<dt><a name="void_*_new_bufferlike_header"
><b><code>void *new_bufferlike_header</b></code></a></dt>
Returns a new buffer&#45;like header from the appropriate sized pool.
<dt><a name="void_Parrot_gc_free_pmc"
><b><code>void Parrot_gc_free_pmc</b></code></a></dt>
Frees a PMC that is no longer being used.
Calls a custom <code>destroy</code> VTABLE method if one is available.
If the PMC uses a PMC_EXT structure,
that is freed as well.
<dt><a name="void_Parrot_gc_free_pmc_ext"
><b><code>void Parrot_gc_free_pmc_ext</b></code></a></dt>
Frees the <code>PMC_EXT</code> structure attached to a PMC,
if it exists.
<dt><a name="void_Parrot_gc_free_sysmem"
><b><code>void Parrot_gc_free_sysmem</b></code></a></dt>
If the PMC uses memory allocated directly from the system,
this function frees that memory.
<dt><a name="void_Parrot_gc_free_buffer_malloc"
><b><code>void Parrot_gc_free_buffer_malloc</b></code></a></dt>
Frees the given buffer,
returning the storage space to the operating system and removing it from Parrot&#39;s memory management system.
If the buffer is COW,
The buffer is not freed if the reference count is greater then 1.
<dt><a name="void_Parrot_gc_free_buffer"
><b><code>void Parrot_gc_free_buffer</b></code></a></dt>
Frees a buffer,
returning it to the memory pool for Parrot to possibly reuse later.
<dt><a name="static_size_t_find_common_mask"
><b><code>static size_t find_common_mask</b></code></a></dt>
Finds a mask covering the longest common bit&#45;prefix of <code>val1</code> and <code>val2</code>.
<dt><a name="void_trace_mem_block"
><b><code>void trace_mem_block</b></code></a></dt>
Traces the memory block between <code>lo_var_ptr</code> and <code>hi_var_ptr</code>.
Attempt to find pointers to PObjs or buffers,
and mark them as &#34;alive&#34; if found.
See src/cpu_dep.c for more information about tracing memory areas.
<dt><a name="void_Parrot_gc_profile_start"
><b><code>void Parrot_gc_profile_start</b></code></a></dt>
Records the start time of a DOD run when profiling is enabled.
<dt><a name="void_Parrot_gc_profile_end"
><b><code>void Parrot_gc_profile_end</b></code></a></dt>
Records the end time of the DOD part <code>what</code> run when profiling is enabled.
Also record start time of next part.
<dt><a name="void_Parrot_gc_ms_run_init"
><b><code>void Parrot_gc_ms_run_init</b></code></a></dt>
Prepares the collector for a mark &#38; sweep DOD run.
This is the initializer function for the MS garbage collector.
<dt><a name="void_Parrot_do_dod_run"
><b><code>void Parrot_do_dod_run</b></code></a></dt>
Calls the configured garbage collector to find and reclaim unused headers.</dl>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p><em>include/parrot/gc_api.h</em>,
<em><a href="../cpu_dep.c.html">src/cpu_dep.c</a></em>,
<em>docs/dev/dod.dev</em> and <em><a href="../../docs/pdds/pdd09_gc.pod.html">docs/pdds/pdd09_gc.pod</a></em>.</p>

<h1><a name="HISTORY"
>HISTORY <a href='#_top'><img alt='^' border=0 src='../../../resources/up.gif'></a></a></h1>

<p>Initial version by Mike Lambert on 2002.05.27.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
