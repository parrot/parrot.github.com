<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>Some utility functions</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Some utility functions</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../html/index.html">Contents</a> | <a href="../../html/c.html">C</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>src/utils.c &#45; Some utility functions</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>Prototypes are in <em lang='und' xml:lang='und'>src/misc.h</em>.</p>

<p>Opcode helper functions that don&#39;t really fit elsewhere.</p>

<h2><a name="Functions"
>Functions <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="intval_mod"
><b><code lang='und' xml:lang='und'>intval_mod</b></code></a></dt><p class="pad"></p>

<dd>NOTE: This &#34;corrected mod&#34; algorithm is based on the C code on page 70 of [1].
Assuming correct behavior of the built&#45;in mod operator (%) with positive arguments,
this algorithm implements a mathematically convenient version of mod,
defined thus:</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'>    x mod y = x &#45; y * floor(x / y)</pre>

<dd>For more information on this definition of mod, see section 3.4 of [2], pages 81&#45;85.</dd><p class="pad"></p>

<dd>References:</dd><p class="pad"></p>

<dd>[1] Donald E. Knuth, *MMIXware: A RISC Computer for the Third Millennium* Springer, 1999.</dd><p class="pad"></p>

<dd>[2] Ronald L. Graham, Donald E. Knuth and Oren Patashnik, *Concrete Mathematics*, Second Edition. Addison&#45;Wesley, 1994.</dd><p class="pad"></p>

<dt><a name="floatval_mod"
><b><code lang='und' xml:lang='und'>floatval_mod</b></code></a></dt><p class="pad"></p>

<dd>Returns <code lang='und' xml:lang='und'>n2 mod n3</code>.</dd><p class="pad"></p>

<dd>Includes a workaround for buggy code generation in the <code lang='und' xml:lang='und'>lcc</code> compiler.</dd><p class="pad"></p>
</dl>

<h2><a name="Random_Number_Generator"
>Random Number Generator <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Based on the <code lang='und' xml:lang='und'>rand48()</code> family of functions.</p>

<dl>
<dt><a name="next_rand"
><b><code lang='und' xml:lang='und'>next_rand</b></code></a></dt><p class="pad"></p>

<dd>Returns the next random number in <code lang='und' xml:lang='und'>X</code>.</dd><p class="pad"></p>

<dt><a name="_erand48"
><b><code lang='und' xml:lang='und'>_erand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>double</code> in the interval <code lang='und' xml:lang='und'>[0.0, 1.0)</code>.</dd><p class="pad"></p>

<dt><a name="_drand48"
><b><code lang='und' xml:lang='und'>_drand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>double</code> in the interval <code lang='und' xml:lang='und'>[0.0, 1.0)</code>.</dd><p class="pad"></p>

<dt><a name="_jrand48"
><b><code lang='und' xml:lang='und'>_jrand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>long</code> in the interval <code lang='und' xml:lang='und'>[&#45;2^31, 2^31)</code>.</dd><p class="pad"></p>

<dt><a name="_nrand48"
><b><code lang='und' xml:lang='und'>_nrand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>long</code> in the interval <code lang='und' xml:lang='und'>[0, 2^31)</code>.</dd><p class="pad"></p>

<dt><a name="_lrand48"
><b><code lang='und' xml:lang='und'>_lrand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>long</code> in the interval <code lang='und' xml:lang='und'>[0, 2^31)</code>.</dd><p class="pad"></p>

<dt><a name="_mrand48"
><b><code lang='und' xml:lang='und'>_mrand48</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>long</code> in the interval <code lang='und' xml:lang='und'>[&#45;2^31, 2^31)</code>.</dd><p class="pad"></p>

<dt><a name="_srand48"
><b><code lang='und' xml:lang='und'>_srand48</b></code></a></dt><p class="pad"></p>

<dd>Sets the high order 32 bits to the argument <code lang='und' xml:lang='und'>seed</code>. The low order 16 bits are set to the arbitrary value 0x330e.</dd><p class="pad"></p>

<dt><a name="Parrot_float_rand"
><b><code lang='und' xml:lang='und'>Parrot_float_rand</b></code></a></dt><p class="pad"></p>

<dd>Returns a <code lang='und' xml:lang='und'>FLOATVAL</code> in the interval <code lang='und' xml:lang='und'>[0.0, 1.0)</code>.</dd><p class="pad"></p>

<dd><code lang='und' xml:lang='und'>how_random</code> is ignored.</dd><p class="pad"></p>

<dt><a name="Parrot_uint_rand"
><b><code lang='und' xml:lang='und'>Parrot_uint_rand</b></code></a></dt><p class="pad"></p>

<dd>Returns an <code lang='und' xml:lang='und'>INTVAL</code> in the interval <code lang='und' xml:lang='und'>[0, 2^31)</code>.</dd><p class="pad"></p>

<dd><code lang='und' xml:lang='und'>how_random</code> is ignored.</dd><p class="pad"></p>

<dt><a name="Parrot_int_rand"
><b><code lang='und' xml:lang='und'>Parrot_int_rand</b></code></a></dt><p class="pad"></p>

<dd>Returns an <code lang='und' xml:lang='und'>INTVAL</code> in the interval <code lang='und' xml:lang='und'>[&#45;2^31, 2^31)</code>.</dd><p class="pad"></p>

<dd><code lang='und' xml:lang='und'>how_random</code> is ignored.</dd><p class="pad"></p>

<dt><a name="Parrot_range_rand"
><b><code lang='und' xml:lang='und'>Parrot_range_rand</b></code></a></dt><p class="pad"></p>

<dd>Returns an <code lang='und' xml:lang='und'>INTVAL</code> in the range <code lang='und' xml:lang='und'>[from, to]</code>.</dd><p class="pad"></p>

<dd><code lang='und' xml:lang='und'>how_random</code> is ignored.</dd><p class="pad"></p>

<dt><a name="Parrot_srand"
><b><code lang='und' xml:lang='und'>Parrot_srand</b></code></a></dt><p class="pad"></p>

<dd>Seeds the random number generator with <code lang='und' xml:lang='und'>seed</code>.</dd><p class="pad"></p>
</dl>

<h2><a name="Array_Functions"
>Array Functions <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="Parrot_make_la"
><b><code lang='und' xml:lang='und'>Parrot_make_la</b></code></a></dt><p class="pad"></p>

<dd>Creates a C array of <code lang='und' xml:lang='und'>long</code>s with one more element than the number of elements in <code lang='und' xml:lang='und'>*array</code>. The elements are then copied from <code lang='und' xml:lang='und'>*array</code> to the new array, and the last (extra) element is set to 0.</dd><p class="pad"></p>

<dd>Used in <code lang='und' xml:lang='und'>src/nci.c</code>.</dd><p class="pad"></p>

<dt><a name="Parrot_destroy_la"
><b><code lang='und' xml:lang='und'>Parrot_destroy_la</b></code></a></dt><p class="pad"></p>

<dd>Use this to destroy an array created with <code lang='und' xml:lang='und'>Parrot_make_la()</code>.</dd><p class="pad"></p>

<dt><a name="Parrot_make_cpa"
><b><code lang='und' xml:lang='und'>Parrot_make_cpa</b></code></a></dt><p class="pad"></p>

<dd>Creates a C array of <code lang='und' xml:lang='und'>char *</code>s with one more element than the number of elements in <code lang='und' xml:lang='und'>*array</code>. The elements are then copied from <code lang='und' xml:lang='und'>*array</code> to the new array, and the last (extra) element is set to 0.</dd><p class="pad"></p>

<dd>Currently unused.</dd><p class="pad"></p>

<dd>Note that you need to free this array with <code lang='und' xml:lang='und'>Parrot_destroy_cpa()</code>.</dd><p class="pad"></p>

<dt><a name="Parrot_destroy_cpa"
><b><code lang='und' xml:lang='und'>Parrot_destroy_cpa</b></code></a></dt><p class="pad"></p>

<dd>Use this to destroy an array created with <code lang='und' xml:lang='und'>Parrot_make_cpa()</code>.</dd><p class="pad"></p>

<dt><a name="tm_to_array"
><b><code lang='und' xml:lang='und'>tm_to_array</b></code></a></dt><p class="pad"></p>

<dd>Helper to convert a <b>struct tm *</b> to an Array</dd><p class="pad"></p>

<dt><a name="rec_climb_back_and_mark"
><b><code lang='und' xml:lang='und'>rec_climb_back_and_mark</b></code></a></dt><p class="pad"></p>

<dd>Recursive function, used by Parrot_register_move to climb back the graph of register moves operations.</dd><p class="pad"></p>

<dd>The node must have a predecessor: it is implicit because if a node has a node_index, it must have a predecessor because the node_index are the index of registers in dest_regs[] array, so by definition they have a corrsponding src_regs register.</dd><p class="pad"></p>

<dd>Then it emits the move operation with its predecessor, or its backup if already used/visited.</dd><p class="pad"></p>

<dd>Then continues the climbing if the predecessor was not modified, anf in that case marks it, and set node_index as its backup.</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'>  node_index  ... the index of a destination (i.e. with a pred.) register
  c           ... the graph and all the needed params : the context</pre>

<dt><a name="process_cycle_without_exit"
><b><code lang='und' xml:lang='und'>process_cycle_without_exit</b></code></a></dt><p class="pad"></p>

<dd>Recursive function, used by Parrot_register_move to handle the case of cycles without exits, that are cycles of move ops between registers where each register has exactly one predecessor and one successor</dd><p class="pad"></p>

<dd>For instance: 1&#45;&#45;&#62;2, 2&#45;&#45;&#62;3, 3&#45;&#45;&#62;1</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'>  node_index  ... the index of a destination (i.e. with a pred.) register
  c           ... the graph and all the needed params : the context</pre>
</dl>

<h1><a name="HISTORY"
>HISTORY <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>Initial version by leo 2003.09.09.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
