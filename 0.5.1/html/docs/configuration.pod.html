<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>Parrot Configuration System</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Parrot Configuration System</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../html/index.html">Contents</a> | <a href="../../html/config.html">Configuration</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>docs/configuration.pod &#45; Parrot Configuration System</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>Parrot configuration is broken up into <i>steps</i>.
Each step contains several related <i>prompts</i>,
<i>probes</i>,
or <i>generations</i>.
Steps should be mostly of a single type,
though some overlap is allowed (for example,
allowing a probe to ask the user what to do in an exceptional situation).</p>

<p>The directory <em lang='und' xml:lang='und'>config</em> contains subdirectories for each type of step.
Each step should consist of <i>exactly one</i> <em lang='und' xml:lang='und'>.pm</em> file and any number of supporting <em lang='und' xml:lang='und'>.c</em>,
<em lang='und' xml:lang='und'>.in</em>,
etc.
files.
Any supporting files should be in a folder whose name is the same as the basename of the step&#39;s <em lang='und' xml:lang='und'>.pm</em> file; for example,
if <em lang='und' xml:lang='und'>foo.pm</em> uses <em lang='und' xml:lang='und'>bar_c.in</em>,
<em lang='und' xml:lang='und'>bar_c.in</em> should be in a directory called <em lang='und' xml:lang='und'>foo</em>; the full path might be <em lang='und' xml:lang='und'>config/auto/foo/bar_c.in</em>.</p>

<p>Generally,
when adding a new component to the configuration process you should add a new step unless that component <i>clearly</i> belongs in a current step.
For example,
if you added a new user&#45;configurable type called <code lang='und' xml:lang='und'>FOOVAL</code>,
you would add the code used to determine its size in <em lang='und' xml:lang='und'><a href="../config/auto/sizes.pm.html">config/auto/sizes.pm</a></em>.
However,
if you were determining what dynaloading capabilities are available,
you would create a new step.</p>

<h2><a name="Initialization_Steps"
>Initialization Steps <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p><i>Initialization steps</i> are run before any other steps.
They do tasks such as preparing the configuration system&#39;s data structures and checking the <em lang='und' xml:lang='und'>MANIFEST</em>.
New initialization steps will only be added when the configuration system is getting significant new capabilities.
They&#39;re kept in the directory <em lang='und' xml:lang='und'>config/init</em>.</p>

<h2><a name="Prompts"
>Prompts <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Prompts ask the user for some information.
These should be used sparingly.
A step containing prompts is an <i>interactive step</i>.
Interactive steps should be in the <em lang='und' xml:lang='und'>config/inter</em> folder.</p>

<p>Interactive steps often include simple probes to determine good guesses of what the user will answer.
See <a href='#Prompt_or_Probe%3F'>&#34;Prompt or Probe?&#34;</a> for more information.</p>

<p>Note that,
by default,
these prompts are turned off.
To enable them run <em lang='und' xml:lang='und'><a href="../Configure.pl.html">Configure.pl</a></em> with the <code lang='und' xml:lang='und'>&#45;&#45;ask</code> option.</p>

<h2><a name="Probes"
>Probes <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Probes are automated tests of some feature of the computer.
These should be used wherever a value will not need to be modified often by the user.
A step containing probes is an <i>automatic step</i>.
Automatic steps should be in the <em lang='und' xml:lang='und'>config/auto</em> folder.</p>

<h2><a name="Generations"
>Generations <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Generations create files needed after configuration has completed,
such as Makefiles and configuration headers.
A step containing generations is a <i>generation step</i>.
Generation steps should be in the <em lang='und' xml:lang='und'>config/gen</em> folder.</p>

<p>Templates for files to be generated usually have the extension <em lang='und' xml:lang='und'>.in</em>.
There are variable substitutes and funny macros like &#39;CONDITIONED_LINE&#39; and &#39;INVERSE_CONDITIONED_LINE&#39;.</p>

<h2><a name="Prompt_or_Probe?"
>Prompt or Probe? <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>It can sometimes be hard to decide whether a given step should be an automatic or an interactive step.
The guiding question is <i>Would a user ever want to change this?</i>,
or conversely,
<i>Is this something that can be completely determined without user intervention?</i> A step figuring out what the compiler&#39;s command is would probably be an interactive step; conversely,
a step figuring out if that command is connected to a specific compiler (like <em lang='und' xml:lang='und'>gcc</em>) would be an automatic step.</p>

<h2><a name="Configuring_Configuration"
>Configuring Configuration <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>The configuration system gets its own configuration data from,
and is invoked via,
the <em lang='und' xml:lang='und'><a href="../Configure.pl.html">Configure.pl</a></em> script.
The system is invoked by instantiating a <a href='..%2Flib%2FParrot%2FConfigure.pm.html'>Parrot::Configure</a> object,
registering one or more steps with that object,
and then calling <code lang='und' xml:lang='und'>Parrot::Configure::runsteps()</code>.</p>

<h2><a name="Adding_New_Steps"
>Adding New Steps <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>New steps should be added in one of the four folders mentioned above.</p>

<p>All steps are really classes; each exists in a unique namespace.
The namespace used depends on the step&#39;s relative path in the source tree sans the <em lang='und' xml:lang='und'>config</em> prefix.
For example,
the step <em lang='und' xml:lang='und'><a href="../config/init/defaults.pm.html">config/init/defaults.pm</a></em> uses the <code lang='und' xml:lang='und'>init::defaults</code> namespace.</p>

<p>Each step inherits its constructor and some other methods from <em lang='und' xml:lang='und'><a href="../lib/Parrot/Configure/Step/Base.pm.html">lib/Parrot/Configure/Step/Base.pm</a></em>.
Each step needs to define only two methods: <code lang='und' xml:lang='und'>_init()</code> and <code lang='und' xml:lang='und'>runstep()</code>.</p>

<p>The <code lang='und' xml:lang='und'>_init()</code> method should follow the following example,
defining three elements within an internal hash:</p>

<pre lang='und' xml:lang='und'>    sub _init {
        my $self = shift;
        my %data;
        $data{description} = q{This is the step description};
        $data{args}        = [ qw( optional arguments ) ];
        $data{result}      = q{};
        return \%data;
    }</pre>

<dl>
<dt><a name="description"
><b><code lang='und' xml:lang='und'>description</b></code></a></dt><p class="pad"></p>

<dd>Of these three elements, <code lang='und' xml:lang='und'>description</code> is the most important as it is used extensively within <code lang='und' xml:lang='und'>lib/Parrot/Configure.pm</code>.</dd><p class="pad"></p>

<dd>Returns a short descriptive message that should be printed before the step executes. Usually, interactive steps have long, friendly descriptions and other steps have terse descriptions ending in &#34;...&#34;.</dd><p class="pad"></p>

<dd>Some example descriptions:</dd><p class="pad"></p>

<dl>
<dt><a name="config/auto/cgoto.pm"
><em lang='und' xml:lang='und'><a href="../config/auto/cgoto.pm.html">config/auto/cgoto.pm</a></em></a></dt><p class="pad"></p>

<pre lang='und' xml:lang='und'>    Determining if your compiler supports computed goto...</pre>

<dt><a name="gen/config_h.pm"
><em lang='und' xml:lang='und'>gen/config_h.pm</em></a></dt><p class="pad"></p>

<pre lang='und' xml:lang='und'>    Generating config.h...</pre>
</dl>

<dd>Note that on non&#45;interactive steps, the text <i>done</i> will be printed after the description when the step finishes executing; for example, the user will see:</dd><p class="pad"></p>

<pre lang='und' xml:lang='und'>    Determining if your compiler supports computed goto...done.</pre>

<dt><a name="args"
><b><code lang='und' xml:lang='und'>args</b></code></a></dt><p class="pad"></p>

<dd>Returns a list of the names of any command&#45;line arguments the step cares about. Command&#45;line arguments are standardized in <em lang='und' xml:lang='und'><a href="../Configure.pl.html">Configure.pl</a></em>; this will be described <a href='#Command%2Dline_Arguments'>later</a> in more detail.</dd><p class="pad"></p>

<dd><i>XXX</i> Note that this method is currently unused but will be used in the futher to register acceptable CLI parameters. New steps should continue to define this method.</dd><p class="pad"></p>

<dt><a name="result"
><b><code lang='und' xml:lang='und'>result</b></code></a></dt><p class="pad"></p>

<dd>The <code lang='und' xml:lang='und'>result</code> is initialized to an empty string mainly to quiet &#39;uninitialized variable&#39; warnings. Most configuration steps override the <code lang='und' xml:lang='und'>result</code> value inside their <code lang='und' xml:lang='und'>runstep()</code> method.</dd><p class="pad"></p>

<dt><a name="_run_this_step"
><a href='TODO'>_run_this_step</a></a></dt><p class="pad"></p>

<dd>This method is called to actually execute the step. The return value should be <code lang='und' xml:lang='und'>1</code> if the step accomplishes what it is intended to do. Otherwise, the step should simply <code lang='und' xml:lang='und'>return</code>, <i>i.e.</i>, return an undefined value.</dd><p class="pad"></p>

<dd><i>XXX</i> In the near future there will be a means of passing additional parameters.</dd><p class="pad"></p>
</dl>

<p>The configuration system won&#39;t execute your step by default unless it&#39;s specifically told to. To do this, edit <em lang='und' xml:lang='und'><a href="../lib/Parrot/Configure/Step/List.pm.html">lib/Parrot/Configure/Step/List.pm</a></em>. Steps are run in the order in which that are registered with the <a href='..%2Flib%2FParrot%2FConfigure.pm.html'>Parrot::Configure</a> object.</p>

<p>Various utility functions for configuration steps are provided by the <a href='..%2Flib%2FParrot%2FConfigure%2FStep.pm.html'>Parrot::Configure::Step</a> module.</p>

<p>A template for a new step might look like this:</p>

<pre lang='und' xml:lang='und'>    package auto::newstep;

    use strict;
    use warnings;
    use vars qw($description $result @args);

    use base qw(Parrot::Configure::Step::Base);

    use Parrot::Configure::Step;

    sub _init {
        my $self = shift;
        my %data;
        $data{description} = q{This is the step description};
        $data{args}        = [ qw( optional arguments ) ];
        $data{result}      = q{};
        return \%data;
    }

    sub runstep {
        my ($self, $conf) = @_
        ...
        if ($success) {
            $self&#45;&#62;set_result(&#39;yes&#39;);
            return 1;
        } else {
            $self&#45;&#62;set_result(&#39;no&#39;);
            return;
        }
    }</pre>

<p>The step&#39;s <code lang='und' xml:lang='und'>runstep()</code> method should return <code lang='und' xml:lang='und'>1</code> upon success and do a bare return on failure (thereby returning an undefined value).</p>

<h2><a name="Command&#45;line_Arguments"
>Command&#45;line Arguments <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Command&#45;line arguments look like <code lang='und' xml:lang='und'>/&#45;&#45;[&#45;\w]+(=.*)?/</code>; the equals sign separates the name and the value. If the value is omitted, it&#39;s assumed to be 1. The options <code lang='und' xml:lang='und'>&#45;&#45;help</code> and <code lang='und' xml:lang='und'>&#45;&#45;version</code> are built in to Configure; any others are defined by steps.</p>

<p>Command&#45;line arguments are now processed by <code lang='und' xml:lang='und'>process_options()</code>, a subroutine exported by <a href='..%2Flib%2FParrot%2FConfigure%2FOptions.pm.html'>Parrot::Configure::Options</a>. If you add a new option, don&#39;t forget to add it to this documentation and to two locations in <em lang='und' xml:lang='und'><a href="../lib/Parrot/Configure/Options.pm.html">lib/Parrot/Configure/Options.pm</a></em>:</p>

<ul>
<li>the list of valid command&#45;line arguments in <code lang='und' xml:lang='und'>Parrot::Configure::Options::get_valid_options()</code>; and</li><p class="pad"></p>

<li>the description of command&#45;line arguments found in <code lang='und' xml:lang='und'>Parrot::Configure::Options::print_help()</code>.</li><p class="pad"></p>
</ul>

<p>Arguments passed to <em lang='und' xml:lang='und'><a href="../Configure.pl.html">Configure.pl</a></em> are held in a <a href='..%2Flib%2FParrot%2FConfigure%2FData.pm.html'>Parrot::Configure::Data</a> object stored inside the <a href='..%2Flib%2FParrot%2FConfigure.pm.html'>Parrot::Configure</a> object. The options data object may be accessed via the <a href='..%2Flib%2FParrot%2FConfigure.pm.html#options'>&#34;options&#34; in Parrot::Configure</a> method.</p>

<p>Steps use the <code lang='und' xml:lang='und'>args</code> method to list any options they&#39;re interested in. They should be listed without the dashes.</p>

<h2><a name="Building_Up_Configuration_Data"
>Building Up Configuration Data <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>The second step is <em lang='und' xml:lang='und'><a href="../config/init/defaults.pm.html">config/init/defaults.pm</a></em>, which sets up some defaults in a <a href='..%2Flib%2FParrot%2FConfigure%2FData.pm.html'>Parrot::Configure::Data</a> object contained by the main <a href='..%2Flib%2FParrot%2FConfigure.pm.html'>Parrot::Configure</a> object. It can be accessed via the <a href='..%2Flib%2FParrot%2FConfigure.pm.html#data'>&#34;data&#34; in Parrot::Configure</a>method. You get and set configuration system&#39;s data by interacting with this object. Some of its methods are summarized below.</p>

<dl>
<dt><a name="get(keys)"
><b><code lang='und' xml:lang='und'>get(keys)</b></code></a></dt><p class="pad"></p>

<dd>Returns the values for the given keys.</dd><p class="pad"></p>

<dt><a name="set(key,_value,_[key,_value,_...])"
><b><code lang='und' xml:lang='und'>set(key, value, [key, value, ...])</b></code></a></dt><p class="pad"></p>

<dd>Sets the given keys to the given values.</dd><p class="pad"></p>

<dt><a name="add(delim,_key,_value,_[key,_value,_...])"
><b><code lang='und' xml:lang='und'>add(delim, key, value, [key, value, ...])</b></code></a></dt><p class="pad"></p>

<dd>Sets the given keys to the given values or appends values delimited by <i>delim</i> to existing keys.</dd><p class="pad"></p>

<dt><a name="keys()"
><b><code lang='und' xml:lang='und'>keys()</b></code></a></dt><p class="pad"></p>

<dd>Returns a list of all keys.</dd><p class="pad"></p>

<dt><a name="dump()"
><b><code lang='und' xml:lang='und'>dump()</b></code></a></dt><p class="pad"></p>

<dd>Returns a string that can be <code lang='und' xml:lang='und'>eval</code>ed by Perl to create a hash representing the configuration system&#39;s data.</dd><p class="pad"></p>

<dd>See the <a href='..%2Flib%2FParrot%2FConfigure%2FData.pm.html'>Parrot::Configure::Data</a> documentation for further details.</dd><p class="pad"></p>
</dl>

<h2><a name="Special_Configuration_Items"
>Special Configuration Items <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Some configuration items, by convention, have a special meaning (mainly prefixes) and are handled with some magic internally.</p>

<dl>
<dt><a name="i_(\w+)_include_files"
><b><code lang='und' xml:lang='und'>i_(\w+)</b></code> include files</a></dt><p class="pad"></p>

<dd>defines or undefs PARROT_HAS_HEADER_XXX in <em lang='und' xml:lang='und'>include/parrot/has_header.h</em></dd><p class="pad"></p>

<dt><a name="HAS_(\w+)_features"
><b><code lang='und' xml:lang='und'>HAS_(\w+)</b></code> features</a></dt><p class="pad"></p>

<dd>defines PARROT_HAS_XXX in <em lang='und' xml:lang='und'>include/parrot/has_header.h</em></dd><p class="pad"></p>

<dt><a name="TEMP_(\w+)_temporary_settings"
><b><code lang='und' xml:lang='und'>TEMP_(\w+)</b></code> temporary settings</a></dt><p class="pad"></p>

<dd>These settings are deleted before <em lang='und' xml:lang='und'><a href="../lib/Parrot/Config.pm.html">lib/Parrot/Config.pm</a></em> is written. These entries are only used e.g. for Makefile creation.</dd><p class="pad"></p>
</dl>

<h2><a name="Accessing_Configuration_Information_via_Perl_5_Variables"
>Accessing Configuration Information via Perl 5 Variables <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Parrot configuration is currently jump&#45;started by extracting considerable information from variables associated with the instance of Perl 5 which the user is using to run <em lang='und' xml:lang='und'><a href="../Configure.pl.html">Configure.pl</a></em>. These variables are largely looked up in the <code lang='und' xml:lang='und'>%Config</code> found in the Perl 5 <em lang='und' xml:lang='und'>Config.pm</em>, but may also be sought in Perl 5 special variables such as <code lang='und' xml:lang='und'>$^O</code>. All such lookups should be done in configuration step <code lang='und' xml:lang='und'>init::defaults</code> and <b>only</b> in that step. Special accessors are available for working with such variables; see <em lang='und' xml:lang='und'><a href="../config/init/defaults.pm.html">config/init/defaults.pm</a></em> and <em lang='und' xml:lang='und'><a href="../lib/Parrot/Configure/Data.pm.html">lib/Parrot/Configure/Data.pm</a></em>.</p>

<h1><a name="HISTORY"
>HISTORY <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>The Parrot configuration system was created by Brent Dax and has been heavily mangled by Joshua Hoblitt.</p>

<h1><a name="SEE_ALSO"
>SEE ALSO <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p><a href='..%2Flib%2FParrot%2FConfigure.pm.html'>Parrot::Configure</a>, <a href='..%2Flib%2FParrot%2FConfigure%2FData.pm.html'>Parrot::Configure::Data</a>, <a href='..%2Flib%2FParrot%2FConfigure%2FStep.pm.html'>Parrot::Configure::Step</a>, <a href='..%2Flib%2FParrot%2FConfigure%2FStep%2FBase.pm.html'>Parrot::Configure::Step::Base</a></p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../resources/parrot_small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
