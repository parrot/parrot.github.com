<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>Untitled</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Untitled</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../html/index.html">Contents</a> | <a href="../../../../html/languages.html">Language Implementations</a> | <a href="../../../../html/dotnet.html">.Net</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a
>Overview This document contains an overview of the internals of the .NET EXE/DLL file to PIR translator.
If you are looking to use the translator rather than hack on it,
you&#39;re probably reading the wrong document; see <a href='TODO'>contents.pod</a> instead. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<h2><a
>Process Overview This describes the steps that take place in converting a .NET EXE or DLL file into Parrot bytecode,
ready to execute natively in Parrot or write to a file for later loading by Parrot programs. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<pre lang='und' xml:lang='und'>                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |  .NET CLI EXE or DLL File  |
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                               _||_
                               \  /
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |    Metadata Translator     |&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          |
                                ||                      +&#45;&#45;&#45;&#45;&#45;&#45;+
                               _||_                     | PMCs |
                               \  /                     +&#45;&#45;&#45;&#45;&#45;&#45;+
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+          |
                   |   Instruction Translator   |&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                               _||_
                               \  /
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   |    Translated PIR Code     |
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;||&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                                ||
                               _||_
                               \  /
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;\/&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+
                   | Translated Parrot Bytecode |
                   +&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;&#45;+</pre>

<h2><a
>PMCs These are classes implemented in C. Method calls and operations can be performed on them from Parrot programs. In this translation system, they are being used to enable parts of the system to be written in C. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<p>Details of them can be found in <a href='TODO'>pmcs.pod</a> and the source files are in the &#34;pmc&#34; directory and have file extension &#34;.pmc&#34;. The .c and most of the .h files are generated, so should not be modified; &#34;structures.h&#34; and &#34;tableinfo.h&#34; are the two exceptions to this rule.</p>

<h2><a
>Metadata Translator In .NET, A lot of data about classes and their methods and fields is not stored in the instruction stream but rather in a set of tables. This part of the system takes the data in the tables and turns it into Parrot intermediate code. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<p>This module uses the PMCs extensively. It translates the class hierachy, fields and method headers with their parameter list and local variables. It delegates the translation of the method body to the instruction translator.</p>

<p>The source for this subsystem is found in the &#34;src&#34; directory. It is written in PIR.</p>

<h2><a
>Instruction Translator This part of the system translates .NET method bodies into PIR. It maps .NET instructions to Parrot instructions and maps the stack onto some Parrot registers. This is easily the most complex part of the system. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<p>Rules and stack to register mapping are specified in a number of files and a build tool (located in the &#34;build&#34; directory) turns them into PIR. This resultant PIR ends up in the &#34;src&#34; directory.</p>

<h2><a
>The PIR Compiler This is a part of Parrot, not of the translation system. It simply turns Parrot Intermediate Representation into Parrot bytecode, which the Parrot virtual machine can execute. <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
