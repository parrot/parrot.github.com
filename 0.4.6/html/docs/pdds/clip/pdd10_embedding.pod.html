<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>Parrot&#39;s Embedding and Extending Interface</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Parrot&#39;s Embedding and Extending Interface</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../html/index.html">Contents</a> | <a href="../../../../html/docs.html">Documentation</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>docs/pdds/embedding.pod &#45; Parrot&#39;s Embedding and Extending Interface</p>

<h1><a name="ABSTRACT"
>ABSTRACT <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>What we believe people will do when embedding and extending Parrot,
why they do it,
and how.</p>

<p>{{ NOTE: some of this will later move into pdds 11 &#38; 12,
but for now just want to get the stub checked in.
}}</p>

<h1><a name="VERSION"
>VERSION <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>$Revision: $</p>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Why embed: &#45; access to special features/libraries/languages Parrot provides &#45; need an interpreter for a DSL or existing language &#45; want to run Parrot on another platform or environment (dedicated hardware,
in a web server,
et cetera)</p>

<p>Why extend: &#45; need something NCI doesn&#39;t provide &#45; writing a custom PMC</p>

<p>Philosophical rules: &#45; only ever use opaque pointers &#45; should be able to communicate through PMCs &#45; minimize conversions to and from C data &#45; perhaps macros; Ruby does this fairly well and Perl 5 does this poorly &#45; minimize the number of necessary functions &#45; probably can follow core Parrot code to some extent,
but beware the Perl 5 problem &#45; do not expose Parrot internals that may change &#45; probably includes vtable methods on PMCs</p>

<p>Gotchas: &#45; who handles signals?
&#45; who owns file descriptors and other Unix resources?
&#45; is there an exception boundary?
&#45; namespace issues &#45;&#45; especially key related &#45; probably a continuation/control flow boundary &#45; packfiles and compilation units probably too much information for either &#45; do not let MMD and other implementation details escape &#45; okay to require some PBC/PIR/PASM for handling round&#45;trip data &#45; Parrot should not spew errors to STDERR when embedded &#45; const_string() is a real pain,
especially with necessary deallocation &#45; should be access to Parrot&#39;s event loop when embedded &#45; passing var args to Parrot subs likely painful &#45; perhaps macros/functions to add parameters to call &#45; build up a call signature somehow?
&#45; some abstraction for a call frame?</p>

<pre lang='und' xml:lang='und'>        &#45; compiling code from a string should return the PMC Sub entry point (:main)</pre>

<h1><a name="DEFINITIONS"
>DEFINITIONS <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Embedding &#45; using libparrot from within another program, likely with a C/NCI/FFI interface</p>

<p>Extending &#45; writing Parrot extensions, likely through C or another language</p>

<p>In practice, there is little difference between the two; mostly in terms of who has control. The necessary interfaces should stay the same.</p>

<h1><a name="IMPLEMENTATION"
>IMPLEMENTATION <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Implementation details.</p>

<h1><a name="LANGUAGE_NOTES"
>LANGUAGE NOTES <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Notes on application to high&#45;level languages. (optional)</p>

<h1><a name="ATTACHMENTS"
>ATTACHMENTS <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Any associated documents.</p>

<h1><a name="FOOTNOTES"
>FOOTNOTES <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>List of footnotes to the text.</p>

<h1><a name="REFERENCES"
>REFERENCES <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>List of references.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
