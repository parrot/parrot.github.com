<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Parrot  - Parrot Native Object Execution Subsystem</title>
        <link rel="stylesheet" type="text/css"
            href="../../resources/parrot.css"
            media="all">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    </head>
    <body>
        <div id="wrapper">
            <div id="header">

                <a href="http://www.parrot.org">
                <img border=0 src="../../resources/parrot_logo.png" id="logo" alt="parrot">
                </a>
            </div> <!-- "header" -->
            <div id="divider"></div>
            <div id="mainbody">
                <div id="breadcrumb">
                    <a href="../../html/index.html">Home</a> &raquo; <a href="../../html/developer.html">Developer Documentation</a> &raquo; Parrot Native Object Execution Subsystem
                </div>

<h1><a name="NAME"
>NAME</a></h1>

<p>docs/native_exec.pod &#45; Parrot Native Object Execution Subsystem</p>

<h1><a name="Overview"
>Overview</a></h1>

<p>On supported platforms,
Parrot can use the JIT subsystem to assemble a native executable binary from a Parrot program.
This method wraps the VM runtime engine and a precompiled Parrot program into a single binary.</p>

<h1><a name="Generating_a_native_executable"
>Generating a native executable</a></h1>

<p>Generating a native executable is done in three steps: building a packfile,
assembling a native object,
and then linking the native executable.</p>

<p>The packfile is generated in the standard way from .pir or .pasm source by IMCC.
For a program in myprog.pasm:</p>

<pre>    ./parrot &#45;o myprog.pbc myprog.pasm</pre>

<p>This generates the myprog.pbc packfile. The native object is generated similarly:</p>

<pre>    ./parrot &#45;o myprog.o myprog.pbc</pre>

<p>This creates a native object called myprog.o. Assembly of the executable is done by the &#34;exec&#34; target in the root Makefile like so:</p>

<pre>    make EXEC=myprog exec</pre>

<p>This generates the &#34;myprog&#34; executable, which runs equivalently to</p>

<pre>    ./parrot &#45;R jit myprog.pbc</pre>

<p>minus the time required to JIT&#45;compile the bytecode.</p>

<p>The &#34;hello&#34; target of the root Makefile demonstrates this method for a &#34;Hello world&#34; program.</p>

<h1><a name="Details"
>Details</a></h1>

<h2><a name="Platform_support"
>Platform support</a></h2>

<p>The exec subsystem is enabled if support is determined automatically by config/auto/jit.pl, or if the option &#45;&#45;execcapable is explicitly specified to Configure.pl. The platform must support the JIT core, and some additional scaffold in the exec* sources must be provided. Implementation of such is beyond the scope of this document.</p>

<h2><a name="Native_object_generation"
>Native object generation</a></h2>

<p>Native objects are generated by the &#34;exec&#34; run core. This core uses the JIT subsystem to compile a packfile to native instructions, then serializes it to the platform&#39;s native object format. This object is then loaded at runtime and executed using the normal JIT core.</p>

<p>Unlike the standard cores (switch, computed goto, etc.) which are activated by command&#45;line switch, the exec core is invoked by IMCC when the output file specified by the &#45;o option has a .o extension. When creating a native object this way, IMCC requires that the input be a packfile. This process therefore must be performed in two steps, building the packfile and assembling the native object, as demonstrated above.</p>

<h2><a name="Executable_generation"
>Executable generation</a></h2>

<p>A native executable is generated by linking a native object against the parrot library and the loader in exec_start.c. The &#34;exec&#34; target in the root Makefile does this with the compile flags used to build parrot itself. Alternatively it may be done by hand, e.g.</p>

<pre>    gcc &#45;o myprog myprog.o src/exec_start.o blib/lib/libparrot.a</pre>

<p>Additional libraries may need to be included as appropriate for the platform.</p>
            </div> <!-- "mainbody" -->
            <div id="divider"></div>
            <div id="footer">
	        Copyright &copy; 2002-2009, Parrot Foundation.
            </div>
        </div> <!-- "wrapper" -->
    </body>
</html>
