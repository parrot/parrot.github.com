<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>  
    <HEAD>
        <TITLE>a PIR sub as source for a Stream</TITLE>
        <LINK REL="stylesheet" TYPE="text/css" 
            HREF="../../../../../resources/perl.css" 
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY> 
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">a PIR sub as source for a Stream</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../../html/index.html">Contents</a> | <a href="../../../../../html/libs.html">Libraries</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="TITLE"
>TITLE <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Stream::Sub &#45; a PIR sub as source for a Stream</p>

<h1><a name="VERSION"
>VERSION <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>version 0.1</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<pre lang='und' xml:lang='und'>    # create the stream
    find_type $I0, &#34;Stream::Sub&#34;
    new stream, $I0

    # set the source sub
    .const .Sub temp = &#34;_test&#34;
    stream.&#34;source&#34;( temp )

    ...

    .sub _test method
        self.&#34;write&#34;( &#34;hello, world&#34; )
    .end</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Like every stream, Stream::Sub as has a <code lang='und' xml:lang='und'>read</code> method. The benefit is that this stream also has a <code lang='und' xml:lang='und'>write</code> method, though it can not be called from arbitrary locations.</p>

<p>You have to provide a Sub PMC that gets called when you call <code lang='und' xml:lang='und'>read</code> for the first time. This sub gets the stream passed in as P2 (&#34;self&#34; if you declare it as a method). You can pass it to other functions if you want. Arguments passed to read on its first invokation are forwarded to the sub you provide. This invokation looks like a method call, but it isn&#39;t one from a technical point of view.</p>

<p>This special &#34;method&#34; can call <code lang='und' xml:lang='und'>write</code>, which will internally create a Continuation to return to the current execution point when read is called the next time. The <code lang='und' xml:lang='und'>read</code> method creates a continuation before invoking the provided sub or the continuation captured by the write method. <code lang='und' xml:lang='und'>read</code>&#39;s continuation is used to return the string parameter passed to <code lang='und' xml:lang='und'>write</code> as the return value of the read method. The parameters passed to <code lang='und' xml:lang='und'>read</code> will be the return values of <code lang='und' xml:lang='und'>write()</code>.</p>

<p>So, if you call the <code lang='und' xml:lang='und'>read</code> method, a part of the provided sub will be run, until it calls the <code lang='und' xml:lang='und'>write</code> method. At this point, the original program execution will continue, until you call the <code lang='und' xml:lang='und'>read</code> method again, which will run the next part of your sub.</p>

<p>The stream will be disconnected automatically if the provided sub returns.</p>

<h1><a name="METHODS"
>METHODS <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<dl>
<dt><a name="source.&#34;write&#34;()"
>source.&#34;write&#34;()</a></dt><p class="pad"></p>

<dd>...</dd><p class="pad"></p>

<dt><a name="source.&#34;rawRead&#34;()_(internal)"
>source.&#34;rawRead&#34;() (<b>internal</b>)</a></dt><p class="pad"></p>

<dd>...</dd><p class="pad"></p>
</dl>

<h1><a name="AUTHOR"
>AUTHOR <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Jens Rieks &#60;parrot at jensbeimsurfen dot de&#62; is the author and maintainer. Please send patches and suggestions to the Perl 6 Internals mailing list.</p>

<h1><a name="COPYRIGHT"
>COPYRIGHT <a href='#_top'><img alt='^' border=0 src='../../../../../resources/up.gif'></a></a></h1>

<p>Copyright (c) 2004, the Perl Foundation.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../../resources/parrot.small.png" 
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
