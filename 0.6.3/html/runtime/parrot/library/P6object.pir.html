<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>Perl 6&#45;like methods and metaclasses for Parrot</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Perl 6&#45;like methods and metaclasses for Parrot</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../../../html/index.html">Contents</a> | <a href="../../../../html/libs.html">Libraries</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>P6object &#45; Perl 6&#45;like methods and metaclasses for Parrot</p>

<h1><a name="SYNOPSIS"
>SYNOPSIS <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<pre lang='und' xml:lang='und'>    .sub &#39;main&#39;
        # load this library
        load_bytecode &#39;P6object.pbc&#39;

        ##  grab the P6metaclass protoobject
        .local pmc p6meta
        p6meta = get_hll_global &#39;P6metaclass&#39;

        ##  create a new class ABC::Def with three attributes
        p6meta.&#39;new_class&#39;(&#39;ABC::Def&#39;, &#39;attr&#39;=&#62;&#39;$a @b %c&#39;)

        ##  get the protoobject for ABC::Def
        .local pmc defproto
        defproto = get_hll_global [&#39;ABC&#39;], &#39;Def&#39;

        ##  use the protoobject to create a new ABC::Def object
        .local pmc obj
        obj = defproto.&#39;new&#39;()

        ##  get the class protoobject from any object
        $P0 = obj.&#39;WHAT&#39;()

        ##  get the metaclass for any object
        $P0 = obj.&#39;HOW&#39;()

        ##  create a new class MyHash as a subclass of Parrot&#39;s &#39;Hash&#39;
        p6meta.&#39;new_class&#39;(&#39;MyHash&#39;, &#39;parent&#39;=&#62;&#39;Hash&#39;)

        ##  tell Parrot classes to use a specific protoobject
        $P0 = get_hll_global &#39;MyHash&#39;
        p6meta.&#39;register&#39;(&#39;Hash&#39;, &#39;protoobject&#39;=&#62;$P0)
        $P1 = new &#39;Hash&#39;               # create a Hash
        $P2 = $P1.&#39;WHAT&#39;()             # get its protoobject
        $S3 = $P2                      # stringify
        say $S3                        # &#34;MyHash\n&#34;</pre>

<h1><a name="DESCRIPTION"
>DESCRIPTION <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p><code lang='und' xml:lang='und'>P6object</code> is intended to add Perl 6&#45;like behaviors to objects in Parrot. It creates and maintains protoobjects, and supplies <code lang='und' xml:lang='und'>.WHAT</code> and <code lang='und' xml:lang='und'>.HOW</code> methods to objects and protoobjects in Parrot. Protoobjects also have a default <code lang='und' xml:lang='und'>.new</code> method for creating new instances of a class (classes are able to override this, however).</p>

<h1><a name="CLASSES"
>CLASSES <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<h2><a name="P6object"
>P6object <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<p><code lang='und' xml:lang='und'>P6object</code> is the base class for objects that make use of the P6metamodel. It supplies the <code lang='und' xml:lang='und'>.WHAT</code> and <code lang='und' xml:lang='und'>.HOW</code> methods.</p>

<dl>
<dt><a name="onload()_:anon_:init_:load"
>onload() :anon :init :load</a></dt><p class="pad"></p>

<dd>Initializes the P6object system. Builds protoobjects for <code lang='und' xml:lang='und'>P6object</code> and <code lang='und' xml:lang='und'>P6metaclass</code>.</dd><p class="pad"></p>

<dt><a name="HOW()"
>HOW()</a></dt><p class="pad"></p>

<dd>Return the <code lang='und' xml:lang='und'>P6metaclass</code> of the invocant.</dd><p class="pad"></p>

<dt><a name="WHAT()"
>WHAT()</a></dt><p class="pad"></p>

<dd>Return the <code lang='und' xml:lang='und'>P6protoobject</code> for the invocant.</dd><p class="pad"></p>

<dt><a name="PROTOOVERRIDES()"
>PROTOOVERRIDES()</a></dt><p class="pad"></p>

<dd>Return a list of methods to be overridden in protoobjects for the class. Defaults to &#39;new&#39; (i.e., any &#39;.new&#39; method in a class will override the one given for P6protoobject below).</dd><p class="pad"></p>
</dl>

<h2><a name="P6metaclass"
>P6metaclass <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="WHAT()"
>WHAT()</a></dt><p class="pad"></p>

<dd>Return the protoobject for this metaclass.</dd><p class="pad"></p>

<dt><a name="isa(x)"
>isa(x)</a></dt><p class="pad"></p>

<dd>Return a true value if the invocant &#39;isa&#39; <code lang='und' xml:lang='und'>x</code>.</dd><p class="pad"></p>

<dt><a name="can(x)"
>can(x)</a></dt><p class="pad"></p>

<dd>Return a true value if the invocant &#39;can&#39; <code lang='und' xml:lang='und'>x</code>.</dd><p class="pad"></p>

<dt><a name="add_parent(parentclass_[,_&#39;to&#39;=&#62;parrotclass])"
>add_parent(parentclass [, &#39;to&#39;=&#62;parrotclass])</a></dt><p class="pad"></p>

<dt><a name="register(parrotclass_[,_&#39;name&#39;=&#62;name]_[,_&#39;protoobject&#39;=&#62;proto]_[,_&#39;parent&#39;=&#62;parentclass])"
>register(parrotclass [, &#39;name&#39;=&#62;name] [, &#39;protoobject&#39;=&#62;proto] [, &#39;parent&#39;=&#62;parentclass])</a></dt><p class="pad"></p>

<dd>Sets objects of type <code lang='und' xml:lang='und'>parrotclass</code> to use <code lang='und' xml:lang='und'>protoobject</code>, and verifies that <code lang='und' xml:lang='und'>parrotclass</code> has P6object methods defined on it. This happens either by setting <code lang='und' xml:lang='und'>P6object</code> as a parent of <code lang='und' xml:lang='und'>parrotclass</code>, or by individually composing <code lang='und' xml:lang='und'>P6object</code>&#39;s methods into <code lang='und' xml:lang='und'>parrotclass</code>.</dd><p class="pad"></p>

<dd>The <code lang='und' xml:lang='und'>name</code> parameter causes objects to be registered using a name that differs from the parrotclass name. This is useful when needing to map to a class name that already exists in Parrot (e.g., &#39;Hash&#39; or &#39;Object&#39;).</dd><p class="pad"></p>

<dt><a name="new_class(name_[,_&#39;parent&#39;=&#62;parentclass]_[,_&#39;attr&#39;=&#62;attr])"
>new_class(name [, &#39;parent&#39;=&#62;parentclass] [, &#39;attr&#39;=&#62;attr])</a></dt><p class="pad"></p>

<dd>Create a new class called <code lang='und' xml:lang='und'>name</code> as a subclass of <code lang='und' xml:lang='und'>parentclass</code>. If <code lang='und' xml:lang='und'>parentclass</code> isn&#39;t supplied, defaults to using <code lang='und' xml:lang='und'>P6object</code> as the parent. The <code lang='und' xml:lang='und'>attr</code> parameter is a list of attribute names to be added to the class, specified as either an array or a string of names separated by spaces.</dd><p class="pad"></p>

<dt><a name="get_parrotclass(x)"
>get_parrotclass(x)</a></dt><p class="pad"></p>

<dd>Multimethod helper to return the parrotclass for <code lang='und' xml:lang='und'>x</code>.</dd><p class="pad"></p>
</dl>

<h2><a name="P6protoobject"
>P6protoobject <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h2>

<dl>
<dt><a name="get_string()_(vtable_method)"
>get_string() (vtable method)</a></dt><p class="pad"></p>

<dd>Returns the &#34;shortname&#34; of the protoobject&#39;s class.</dd><p class="pad"></p>

<dt><a name="defined()_(vtable_method)"
>defined() (vtable method)</a></dt><p class="pad"></p>

<dd>Protoobjects are always treated as being undefined.</dd><p class="pad"></p>

<dt><a name="name()_(vtable_method)"
>name() (vtable method)</a></dt><p class="pad"></p>

<dd>Have protoobjects return their longname in response to a <code lang='und' xml:lang='und'>typeof_s_p</code> opcode.</dd><p class="pad"></p>

<dt><a name="new()"
>new()</a></dt><p class="pad"></p>

<dd>Provides a default constructor for creating objects in the class.</dd><p class="pad"></p>

<dd>Note that unlike Perl 6, the <code lang='und' xml:lang='und'>new</code> method here exists only in the protoobject and not in the individual instances of the class. (If you want all objects in a class to have a <code lang='und' xml:lang='und'>new</code> method, then define one in the class and it will be used in lieu of this one.)</dd><p class="pad"></p>

<dt><a name="WHENCE()"
>WHENCE()</a></dt><p class="pad"></p>

<dd>Returns the protoobject&#39;s autovivification closure.</dd><p class="pad"></p>

<dt><a name="get_pmc_keyed(key)_(vtable_method)"
>get_pmc_keyed(key) (vtable method)</a></dt><p class="pad"></p>

<dd>Returns a proto&#45;object with an autovivification closure attached to it.</dd><p class="pad"></p>

<dt><a name="ACCEPTS(topic)"
>ACCEPTS(topic)</a></dt><p class="pad"></p>
</dl>

<h1><a name="AUTHOR"
>AUTHOR <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Written and maintained by Patrick R. Michaud, <code lang='und' xml:lang='und'>pmichaud at pobox.com</code>. Please send patches, feedback, and suggestions to the parrot&#45;porters mailing list or to <code lang='und' xml:lang='und'> parrotbug@perl.org </code>.</p>

<h1><a name="COPYRIGHT"
>COPYRIGHT <a href='#_top'><img alt='^' border=0 src='../../../../resources/up.gif'></a></a></h1>

<p>Copyright (C) 2008, The Perl Foundation.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
