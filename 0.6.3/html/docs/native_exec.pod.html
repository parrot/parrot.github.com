<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"
    "http://www.w3.org/TR/REC-html40/loose.dtd">
<HTML>
    <HEAD>
        <TITLE>Parrot Native Object Execution Subsystem</TITLE>
        <LINK REL="stylesheet" TYPE="text/css"
            HREF="../../resources/perl.css"
            TITLE="Default CSS2" media="screen">
    </HEAD>
    <BODY>
        <A NAME="_top"></A>
        <TABLE CELLSPACING="0" WIDTH="730">
            <TR>
                <TD WIDTH="100%" COLSPAN="2" CLASS="BANNER">parrotcode: <SPAN CLASS="title">Parrot Native Object Execution Subsystem</SPAN></TD>
            </TR>
            <TR>
                <TD WIDTH="100%" COLSPAN="2"  ID="NAV" STYLE="border-bottom: 1px solid #191970;">
                    <a href="../../html/index.html">Contents</a> | <a href="../../html/docs.html">Documentation</a>
                </TD>
            </TR>
        </TABLE>
        <DIV CLASS="pod">

<h1><a name="NAME"
>NAME <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>docs/native_exec.pod &#45; Parrot Native Object Execution Subsystem</p>

<h1><a name="Overview"
>Overview <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>On supported platforms,
Parrot can use the JIT subsystem to assemble a native executable binary from a Parrot program.
This method wraps the VM runtime engine and a precompiled Parrot program into a single binary.</p>

<h1><a name="Generating_a_native_executable"
>Generating a native executable <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<p>Generating a native executable is done in three steps: building a packfile,
assembling a native object,
and then linking the native executable.</p>

<p>The packfile is generated in the standard way from .pir or .pasm source by IMCC.
For a program in myprog.pasm:</p>

<pre lang='und' xml:lang='und'>    ./parrot &#45;o myprog.pbc myprog.pasm</pre>

<p>This generates the myprog.pbc packfile. The native object is generated similarly:</p>

<pre lang='und' xml:lang='und'>    ./parrot &#45;o myprog.o myprog.pbc</pre>

<p>This creates a native object called myprog.o. Assembly of the executable is done by the &#34;exec&#34; target in the root Makefile like so:</p>

<pre lang='und' xml:lang='und'>    make EXEC=myprog exec</pre>

<p>This generates the &#34;myprog&#34; executable, which runs equivalently to</p>

<pre lang='und' xml:lang='und'>    ./parrot &#45;j myprog.pbc</pre>

<p>minus the time required to JIT&#45;compile the bytecode.</p>

<p>The &#34;hello&#34; target of the root Makefile demonstrates this method for a &#34;Hello world&#34; program.</p>

<h1><a name="Details"
>Details <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h1>

<h2><a name="Platform_support"
>Platform support <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>The exec subsystem is enabled if support is determined automatically by config/auto/jit.pl, or if the option &#45;&#45;execcapable is explicitly specified to Configure.pl. The platform must support the JIT core, and some additional scaffold in the exec* sources must be provided. Implementation of such is beyond the scope of this document.</p>

<h2><a name="Native_object_generation"
>Native object generation <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>Native objects are generated by the &#34;exec&#34; run core. This core uses the JIT subsystem to compile a packfile to native instructions, then serializes it to the platform&#39;s native object format. This object is then loaded at runtime and executed using the normal JIT core.</p>

<p>Unlike the standard cores (switch, computed goto, etc.) which are activated by command&#45;line switch, the exec core is invoked by IMCC when the output file specified by the &#45;o option has a .o extension. When creating a native object this way, IMCC requires that the input be a packfile. This process therefore must be performed in two steps, building the packfile and assembling the native object, as demonstrated above.</p>

<h2><a name="Executable_generation"
>Executable generation <a href='#_top'><img alt='^' border=0 src='../../resources/up.gif'></a></a></h2>

<p>A native executable is generated by linking a native object against the parrot library and the loader in exec_start.c. The &#34;exec&#34; target in the root Makefile does this with the compile flags used to build parrot itself. Alternatively it may be done by hand, e.g.</p>

<pre lang='und' xml:lang='und'>    gcc &#45;o myprog myprog.o src/exec_start.o blib/lib/libparrot.a</pre>

<p>Additional libraries may need to be included as appropriate for the platform.</p>
        </DIV>
        <P>
        <TABLE BORDER="0" WIDTH="730" CELLSPACING="0" CELLPADDING="0">
            <TR ALIGN="RIGHT">
                <TD WIDTH="590" VALIGN="MIDDLE">
                    <BR>
                    <DIV CLASS="FOOTER">
                        <DIV ALIGN="LEFT">
                        </DIV>
                    </DIV>
                </TD>
                <TD VALIGN="middle" ALIGN="center">
                    <IMG BORDER=0
                        SRC="../../resources/parrot_small.png"
                        ALT="parrot">
                </TD>
            </TR>
        </TABLE>
    </BODY>
</HTML>
